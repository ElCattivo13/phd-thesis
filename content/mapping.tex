
\chapter{A Mapping from Role-Based Models to Description Logic Ontologies}
\label{cha:mapping}

In the last chapter we introduced a family of description logics which is capable of expressing
contextualised knowledge. This provides the needed expressiveness to be able to reason on role-based
models. But due to the rather elaborate semantics both of role-based models and of contextualised
description logics it will be tedious and error-prone to construct the DL ontology which exactly
captures a role-based model manually, especially since the domain analyst who generates the
role-based model is in general not an expert in DLs. Hence, an automated mapping from role-based
models into DL would be desirable. Therefore, a formal representation of role-based systems with a
well-defined semantics is necessary which is the case since we use role-based systems formalised in
CROM.

In this chapter we will present a mapping algorithm from such role-based models into contextualised
DLs in order to automate this step.
%
% To avoid the confusion with the notations, from now on we differentiate \emph{\rosiroles} as
% in \rosirole-based systems and \emph{roles} as used in description logics whenever we feel it is
% necessary. Otherwise, we drop that distinction if it is clear from the context.
% %
%
In Section~\ref{sec:representating-role-based-models}, we present the mapping algorithm along with
the proof that the mapping preserves the semantics. Then, in Section~\ref{sec:going-beyond-crom} we
discuss possible features of role-based systems that go beyond CROM but still can be expressed in an
ontology.

% In Section~\ref{sec:rosiroles}, we give a short ontological introduction to \rosiroles.  In
% Section~\ref{sec:sigma-crom}, we introduce a syntactical variant of the \emph{Compartment Role Object
%   Model (CROM)}~\cite{KBG-SLE15}.  Then, after discussing requirements for the logical formalism and
% analyse possible candidates for the translation in Section~\ref{sec:requirements-and-CDLs}, we
% present the actual mapping in Section~\ref{sec:representating-role-based-models}. We close this
% chapter in Section~\ref{sec:going-beyond-crom} with possible features of role-based systems that go
% beyond CROM but still can be expressed in an ontology.

% \todo[inline]{rewrite introduction and structure of chapter}


\section{Representing Role-Based Models}
\label{sec:representating-role-based-models}

We would like to emphasise here
%once again
that checking well-formedness of a \SCROM{}~\Mmc and compliance of a constraint set with \Mmc is not
considered here, because these are purely syntactical checks and no reasoning is
necessary. Furthermore, checking whether a given \SCROI satisfies \Mmc is also not the considered
task as it rather belongs to the area of model checking and is not in the scope of this thesis. More
interesting is whether there exists such a \SCROI at all.  Then, we can additionally test if certain
axioms are entailed or whether specific role types can be played since these questions can be
reduced to the satisfiability problem. Thus, the main objective is, given a \SCCROM{} \Kmc, to
construct an \ALCSHOIQ-ontology $\Bmf_{\Kmc}$ such that $\Bmf_{\Kmc}$ is consistent iff \Kmc is
satisfiable.  Which contextualised description logic is exactly necessary depends also on the
constraints occurring in \Kmc and will be discussed in Section~\ref{sec:sem-integ-mapping} in more
detail.

The general idea is to model compartment types as concepts on the meta level, and objects playing a
\rosirole, the relationship types as well as all the constraints within a compartment type on the
object level. For this, we introduce o-concepts for natural types and \rosirole types and a special
object role \plays. The fills relation is transformed into corresponding domain and range axioms for
\plays.

Here, we made a first design decision on how to express that a \rosirole is played within a
compartment. There are two possibilities, depicted in Figure~\ref{fig:two-ways-to-play-roles}, which
we already showed in Example~\ref{ex:nfl-with-contexts}. On the one hand, we can introduce an
o-concept $\mathsf{Coach}\in\RT$ and elements playing a $\mathsf{Coach}$-\rosirole are in the
extension of \rt (such as Mike McCarthy playing the \rosirole of a coach in the left side of
Figure~\ref{fig:two-ways-to-play-roles}). Here, an object $o$ and a \rosirole $r$ with
$(o,\cdot,r)\in\plays$ would be mapped to a single element $d$ in the object interpretation for that
compartment. This variant is close to the ontological nature of \rosiroles where an entity is in the
extension of a \rosirole, seen as unary predicate, if this entity plays that \rosirole. On the other
hand, we can introduce the o-concept $\mathsf{Coach}$ as well but disjoint from $\mathsf{Person}$
and we additionally introduce an object role \plays and elements playing an
$\mathsf{Coach}$-\rosirole have a \plays-successor that is in the extension of $\mathsf{Coach}$
(such as Mike playing the \rosirole of a coach in the left side of
Figure~\ref{fig:two-ways-to-play-roles}).  This is closer to the semantics of \SCROI{s}, but
introduces new object domain elements for each \rosirole that is played.  Still, we chose the latter
variant, since later we need to count the number of \rosiroles to assure occurrence and cardinality
constraints. In~DLs, this can be done via qualified number restrictions.

\begin{figure}
  \centering
  \begin{tikzpicture}
    \node[node,label={[align=left]270:\textit{MikeMcCarthy},\\ $\mathsf{Coach}$}] (mmc) at (-2,0){};
    \node[node,label={[align=left]270:\textit{MikeMcCarthy}}] (ar) at (2,0){};
    \node[node,label={[align=right]south:$\mathsf{Coach}$}] (qb) at (5,0){};
    \draw[edge] (ar) to[bend left=10] node{\plays} (qb);
    \draw[thin] (0,-1.5) to (0,1);
  \end{tikzpicture}
  \caption{Possibilities to formalise objects playing \rosiroles.}
  \label{fig:two-ways-to-play-roles}
\end{figure}

Generally, in a \SCROM, compartments are also allowed to play \rosiroles in other
compartments. Within these other compartments a compartment playing a \rosirole does not behave
differently than a natural. Hence, we have compartment types both as meta concept names, i.e.\ as
contexts in which other objects play \rosiroles, and as object concept types, i.e.\ as objects that
play \rosiroles in a context. In a \SCROM there is a one-to-one relationship, since the compartment
as \rosirole-player and as context is the same object. In our formalism, we cannot establish that
tight connection, but we can assure the existence of contexts of a certain compartment type via a
meta role \nested if objects of that type play \rosiroles. Since we cannot restrict the number of
existing contexts in a nested DL interpretation, this is sufficient for the satisfiability
problem. To distinguish between compartment types as contexts and as objects, we call the former
simply \emph{contexts} and the latter \emph{o-compartments} and introduce a copy \CT* of all
compartment types \CT.

Relationship types are intuitively modelled as object roles. Here, it might be more natural to span these
between the played \rosiroles instead of the players. But due to the one-to-one correspondence
between players and played \rosiroles, we can also construct the relationship types between the
players. In doing so, we can avoid the use of role value maps, which would cause the consistency
problem to become undecidable \cite{Sch89}, to formalise intra relationship type constraints. Even so, we
can only support such constraints that are expressible in the underlying DL.

\Rosirole groups are handled like \rosiroles with an additional axiom stating that ``playing'' a
\rosirole group is equivalent to fulfilling the constraints specified in that \rosirole
group. Furthermore, if an object plays an atom of a top-level \rosirole group, that object must
fulfill the \rosirole group.
%
For the occurrence constraints we introduce a fresh individual name \occurCounter and a object role
\counts and enforce that each played role or fulfilled role group is connected to this
counter. Thereby we can use qualified number restrictions to encode the occurrence constraints.
%
For cardinality constraints, we also utilise number restrictions.

% Ontologically, natural types would be captured as rigid concepts and their attributes, if present, as
% rigid roles, since that information does not change contexts-dependently. In our setting, rigidity
% has no influence on the consistency, and neglecting it decreases the computational complexity
% exponentially in the size of the input. Additionally, the case with rigid names can be handled quite
% similar and we come back to it in Section~\ref{sec:going-beyond-crom}.

To sum up, we consider the object signature $\Osig=(\OC,\OR,\OI)$ and the meta signature
$\Msig=(\MC,\MR,\MI)$ such that
\begin{itemize}
\item $\CT \subseteq \MC$, since every compartment type is a meta concept,
\item $\nested \in \MR$, to assure the existence of compartments that play \rosiroles,
\item $\NT\cup\CT* \subseteq \OCR$, since every natural type and every o-compartment type are rigid
  object concepts,
\item $\RT\subseteq\OCF$, since every \rosirole type is a flexible object concept
\item $\plays\in\ORF$, to express the \plays-relation, 
\item $\RST \subseteq \ORF$, since every relationship type is an object role,
\item $\occurCounter \in \OI$ and $\counts\in\ORF$, to express the occurrence constraints, and
\item $\INDC\in\MI$ and $\IND\in\OI$, to interpret individual names on their respective level. 
\end{itemize}
Additionally, we introduce the following object concept names:
\begin{itemize}
\item $\Ant\in\OCR$ for all objects eligible of playing \rosiroles, i.e.\ naturals and
  o-compartments,
\item $\Art\in\OCF$ for all \rosiroles, and
\item $\Arg\in\OCF$ for all instances of \rosirole groups since we
will consider \rosirole groups of the constraint set similar to \rosiroles.
\end{itemize}



% Additionally, we introduce the rigid object concept $\Ant \in \OCR$ for all objects eligible of
% playing \rosiroles, i.e.\ naturals and o-compartments.  and the flexible object concepts
% $\Art\in\OCF$ for all \rosiroles and $\Arg\in\OCF$ for all instances of \rosirole groups since we
% will consider \rosirole groups of the constraint set similar to \rosiroles.

\subsection{A Mapping for the Vocabulary  \texorpdfstring{\ensureboldmath{\Sigma}}{Sigma}}

In the next sections, we present the mapping from \rosirole-based systems into contextualised
description logics in detail.  At first, we express general knowledge about occurring types which is
independent of the specific \SCROM.


\begin{enumerate}

\item Every context belongs to exactly one compartment type.
\begin{align}
  \top & \sqsubseteq \bigsqcup_{\ct\in\CT} \ct \label{eq:compartments-coverage}\\
  \ct[1] \sqcap \ct[2] & \sqsubseteq \bot 
      \text{\qquad\qquad for all $\ct[1], \ct[2] \in \CT$, $\ct[1]\neq\ct[2]$}\label{eq:compartments-disjoint}
\end{align}

\item In every context, every natural or o-compartment and every \rosirole belongs to exactly one type.
\begin{align}
  \top & \sqsubseteq \oax{ \Ant \equiv \bigsqcup_{\nt\in\NT}\nt \sqcup \bigsqcup_{\ct*\in\CT*}\ct*}\label{eq:naturals-coverage}\\
  \top & \sqsubseteq \oax{ \Art \equiv \bigsqcup\limits_{\rt\in\RT}\rt} \label{eq:roles-coverage}\\
  \top & \sqsubseteq \bigsqcap_{\substack{T_{1},\,T_{2}\in\NT\cup\CT*\cup\RT,\\ T_{1} \neq T_{2}}}
      \oax{T_{1} \sqcap T_{2} \sqsubseteq \bot} \label{eq:roles-disjoint}
\end{align}

\item On the object level, an element can either be a \rosirole, a natural or o-compartment, an
instance of a \rosirole group or the individual \occurCounter.
\begin{align}
  %\top & \sqsubseteq \oax{\top \sqsubseteq \Ant \sqcup \Art \sqcup \Arg \sqcup \{\occurCounter\}}\\
  \begin{split}
  \top & \sqsubseteq \oax{\Ant \sqcap \Art \sqsubseteq \bot} 
      \sqcap \oax{\Ant \sqcap \Arg \sqsubseteq \bot}
      \sqcap \oax{\Art \sqcap \Arg \sqsubseteq \bot} \\
    & \qquad \sqcap \oax{\lnot(\Ant \sqcup \Art \sqcup \Arg)(\occurCounter)}
  \end{split}\label{eq:obj-disjoint}
\end{align}

\item Every natural or o-compartment can play at most one \rt-\rosirole in each context and each
  \rosirole must be played by some object.
  \begin{align}
    \top & \sqsubseteq \bigsqcap_{\rt\in\RT} \oax{\Ant \sqsubseteq \atmost{1}{\plays}{\rt}}\label{eq:roletype-played-max-once} \\
    \top & \sqsubseteq \oax{\Art \sqsubseteq \atleast{1}{\plays^{-}}{\top} 
           \sqcap \atmost{1}{\plays^{-}}{\top}}\label{eq:role-is-played-exactly-once}
  \end{align}

\item We formalise a general domain and range restriction for \plays. Only naturals or
  o-compartments can play something, and only \rosiroles or instances of \rosirole groups can be
  played.
  \begin{align}
    \top & \sqsubseteq \oax{ \exists\plays.\top \sqsubseteq \Ant}\label{eq:plays-domain} \\
    \top & \sqsubseteq \oax{\top \sqsubseteq \forall\plays.(\Art\sqcup\Arg)}\label{eq:plays-range}
  \end{align}

\item Finally, if an o-compartment plays a \rosirole in some context, the o-compartment must also
  exist as context.
  \begin{align}
    \lnot\oax{\ct* \sqcap \exists\plays.\top\sqsubseteq\bot} 
    & \sqsubseteq \exists\nested.\ct
      \text{\hspace{3em} for all $\ct* \in \CT*$}\label{eq:nested-cts}
  \end{align}
\end{enumerate}

% \noindent
% In every context, every natural or o-compartment and every \rosirole belongs to exactly one type.
% \begin{align}
%   \top & \sqsubseteq \oax{ \Ant \equiv \bigsqcup_{\nt\in\NT}\nt \sqcup \bigsqcup_{\ct*\in\CT*}\ct*}\label{eq:naturals-coverage}\\
%   \top & \sqsubseteq \oax{ \Art \equiv \bigsqcup\limits_{\rt\in\RT}\rt} \label{eq:roles-coverage}\\
%   \top & \sqsubseteq \bigsqcap_{\substack{T_{1},\,T_{2}\in\NT\cup\CT*\cup\RT,\\ T_{1} \neq T_{2}}}
%       \oax{T_{1} \sqcap T_{2} \sqsubseteq \bot} \label{eq:roles-disjoint}
% \end{align}

% \noindent
% On object level, an element can either be a \rosirole, a natural or o-compartment, an
% instance of a \rosirole group or the individual \occurCounter.
% \begin{align}
%   %\top & \sqsubseteq \oax{\top \sqsubseteq \Ant \sqcup \Art \sqcup \Arg \sqcup \{\occurCounter\}}\\
%   \begin{split}
%   \top & \sqsubseteq \oax{\Ant \sqcap \Art \sqsubseteq \bot} 
%       \sqcap \oax{\Ant \sqcap \Arg \sqsubseteq \bot}
%       \sqcap \oax{\Art \sqcap \Arg \sqsubseteq \bot} \\
%     & \qquad \sqcap \oax{\lnot(\Ant \sqcup \Art \sqcup \Arg)(\occurCounter)}
%   \end{split}\label{eq:obj-disjoint}
% \end{align}

% \noindent
% Next, every natural or o-compartment can only play one \rt-\rosirole in each context and
% each \rosirole must be played by some object.
% \begin{align}
%   \top & \sqsubseteq \bigsqcap_{\rt\in\RT} \oax{\Ant \sqsubseteq \atmost{1}{\plays}{\rt}}\label{eq:roletype-played-max-once} \\
%   \top & \sqsubseteq \oax{\Art \sqsubseteq \atleast{1}{\plays^{-}}{\top} 
%          \sqcap \atmost{1}{\plays^{-}}{\top}}\label{eq:role-is-played-exactly-once}
% \end{align}

% \noindent
% We formalise a general domain and range restriction for \plays. Only naturals or o-compart\-ments
% can play something, and only \rosiroles or instances of \rosirole groups can be played.
% \begin{align}
%   \top & \sqsubseteq \oax{ \exists\plays.\top \sqsubseteq \Ant}\label{eq:plays-domain} \\
%   \top & \sqsubseteq \oax{\top \sqsubseteq \forall\plays.(\Art\sqcup\Arg)}\label{eq:plays-range}
% \end{align}

% \noindent
% Finally, if an o-compartment plays a \rosirole in some context, the o-compartment must also exist as
% context.
% \begin{align}
%   \lnot\oax{\ct* \sqcap \exists\plays.\top\sqsubseteq\bot} & \sqsubseteq \exists\nested.\ct
%       \text{\hspace{3em} for all $\ct* \in \CT*$}\label{eq:nested-cts}
% \end{align}

\subsection{A Mapping for the \texorpdfstring{\SCROM{} \Mmc}{Sigma-CROM M}}

With the general knowledge about the vocabulary $\Sigma$ being set up, we can look into
the translation of the specifications for a given \SCROM{} \MM.

\begin{enumerate}
\item The \fills-relation specifies which natural or compartment types are allowed to play which \rosirole
types. Hence, elements that play a certain \rosirole type can only be naturals or o-compartments of
types which fill that \rosirole type.
\begin{align}
  \top & \sqsubseteq \bigsqcap_{\rt\in\RT}\oax{\exists\plays.\rt \sqsubseteq 
      \bigg( \bigsqcup\nolimits_{(T,\rt)\in\fills} T \bigg)} \label{eq:fills}
\end{align}
Note here, that Equation~\eqref{eq:fills} is sufficient in the sense that in conjunction with
Equations~\eqref{eq:roles-coverage} and~\eqref{eq:plays-range}, it entails that all \plays-successors
of naturals or o-compartments of a specific type are either instances of a \rosirole type that are
filled by that type or instances of a \rosirole group:
\begin{align*}
  \top & \sqsubseteq \bigsqcap_{T\in\NT\cup\CT*}\oax{T \sqsubseteq \forall\plays.
      \bigg(\Arg \sqcup \bigsqcup\nolimits_{(T,\rt)\in\fills} \rt \bigg)}.
\end{align*}

\item Since in a satisfying \SCROI the \plays-relation respects \parts, only \rt-\rosiroles with
$\rt\in\parts(\ct)$ exist in a \ct-context.
\begin{align}
  \ct & \sqsubseteq \oax{\Art \sqsubseteq \bigsqcup_{\rt\in\parts(\ct)}\rt}
      \text{\hspace{3em} for all $\ct\in\CT$} \label{eq:roles-in-compartment}
\end{align}

\item Analogous to \fills restricting the domain and range of \plays, the \rel-function
restricts them for each relationship type.
\begin{align}
  \begin{split}
    \top & \sqsubseteq \oax{\exists\rst.\top\sqsubseteq\exists\plays.\rt[1]} \sqcap
         \oax{\top\sqsubseteq\forall\rst.(\exists\plays.\rt[2])}\\
       & \hspace{7em}\text{for all $\rst\in\RST$ and $\rel(\rst) = (\rt[1],\rt[2])$}
  \end{split}\label{eq:rst-domain-range}
\end{align}
\end{enumerate}
% The \fills-relation specifies which natural or compartment types are allowed to play which \rosirole
% types. Hence, elements that play a certain \rosirole type can only be naturals or o-compartments of
% types which fill that \rosirole type.
% \begin{align}
%   \top & \sqsubseteq \bigsqcap_{\rt\in\RT}\oax{\exists\plays.\rt \sqsubseteq 
%       \bigg( \bigsqcup\nolimits_{(T,\rt)\in\fills} T \bigg)} \label{eq:fills}
% \end{align}
% Note here, that Equation~\eqref{eq:fills} is sufficient in the sense that in conjunction with
% Equations~\eqref{eq:roles-coverage} and~\eqref{eq:plays-range} it entails that all \plays-successors
% of naturals or o-compartments of a specific type are either instances of a \rosirole type that are
% filled by that type or instances of a \rosirole group.
% \begin{align*}
%   \top & \sqsubseteq \bigsqcap_{T\in\NT\cup\CT*}\oax{T \sqsubseteq \forall\plays.
%       \bigg(\Arg \sqcup \bigsqcup\nolimits_{(T,\rt)\in\fills} \rt \bigg)}.
% \end{align*}

% \noindent Since in a valid \SCROI the \plays-relation respects \parts, only \rt-\rosiroles with
% $\rt\in\parts(\ct)$ exist in a \ct-context.
% \begin{align}
%   \ct & \sqsubseteq \oax{\Art \sqsubseteq \bigsqcup_{\rt\in\parts(\ct)}\rt}
%       \text{\hspace{3em} for all $\ct\in\CT$} \label{eq:roles-in-compartment}
% \end{align}

% \noindent Analogous to \fills restricting the domain and range of \plays, the \rel-function
% restricts them for each relationship type.
% \begin{align}
%   \begin{split}
%     \top & \sqsubseteq \oax{\exists\rst.\top\sqsubseteq\exists\plays.\rt[1]} \sqcap
%          \oax{\top\sqsubseteq\forall\rst.(\exists\plays.\rt[2])}\\
%        & \hspace{7em}\text{for all $\rst\in\RST$ and $\rel(\rst) = (\rt[1],\rt[2])$}
%   \end{split}\label{eq:rst-domain-range}
% \end{align}

\noindent Note here, that due to equations~\eqref{eq:compartments-coverage},
\eqref{eq:roles-coverage},~\eqref{eq:roles-disjoint} and~\eqref{eq:roles-in-compartment} and the
fact that \parts' codomain is a partition of \RT, in any context that is not in \ct there are no
\rosiroles of a type the participates in \ct , e.g. the following axiom is entailed for all
$\ct\in\CT$:
\begin{align*}
  \lnot\ct & \sqsubseteq \oax{\bigsqcup_{\rt\in\parts(\ct)}\rt\sqsubseteq\bot}
\end{align*}

\subsection{A Mapping for the \texorpdfstring{\SCROA{} \A}{Sigma-CROA A}}

Next, let \A be a \SCROA. We can translate the different Compartment Role Object Assertions into
meta assertions in \LMLO.

\begin{enumerate}
\item For any meta type assertion of the form $\ct(c)\in\A$ with $\ct\in\CT$ and $c\in\INDC$ the individual $a$ must be a context of
type \ct.
\begin{gather}
  \ct(c)\label{eq:meta-type-assertion}
\end{gather}

\item For any object type assertion $T(a,c)\in\A$ with $T\in\NT\cup\CT\cup\RT$, $a\in\IND$ and $c\in\INDC$ the individual
$a$ is a natural, an o-compartment or \rosirole
  that belongs to the concept $T$ in context $c$.
\begin{gather}
  \oax{T(a)}(c)\label{eq:obj-type-assertion}
\end{gather}

\item A \plays assertion $\playass(a_{1}, c, a_{2}) \in \A$ states that $a_{1}$ plays $a_{2}$
  in $c$.
\begin{gather}
  \oax{\plays(a_{1},a_{2})}(c)\label{eq:plays-assertion}
\end{gather}

\item A \links assertion $\linkass(\rst, c, a_{1}, a_{2}) \in \A$ states that $a_{1}$ and $a_{2}$ play
\rosiroles which are related in $c$ via \rst. Due to the way we modelled relationship types, this is
simply the following axiom: 
\begin{gather}
  \oax{\rst(a_{1}, a_{2})}(c)\label{eq:links-assertion} 
\end{gather}
\end{enumerate}

% For any meta type assertion of the form $\ct(c)\in\A$ with $\ct\in\CT$ and $c\in\INDC$ the individual $a$ must be a context of
% type \ct.
% \begin{gather}
%   \ct(c)\label{eq:meta-type-assertion}
% \end{gather}

% \noindent
% For any object type assertion $T(a,c)\in\A$ with $T\in\NT\cup\CT\cup\RT$, $a\in\IND$ and $c\in\INDC$ the individual
% $a$ is a natural, an o-compartment or \rosirole
%   that belongs to the concept $T$ in context $c$.
% \begin{gather}
%   \oax{T(a)}(c)\label{eq:obj-type-assertion}
% \end{gather}

% \noindent
% A \plays assertion $\playass(a_{1}, c, a_{2}) \in \A$ states that $a_{1}$ plays $a_{2}$
%   in $c$.
% \begin{gather}
%   \oax{\plays(a_{1},a_{2})}(c)\label{eq:plays-assertion}
% \end{gather}

% \noindent
% A \links assertion $\linkass(\rst, c, a_{1}, a_{2}) \in \A$ states that $a_{1}$ and $a_{2}$ play
% \rosiroles which are related in $c$ via \rst. Due to the way we modelled relationship types, this is
% simply the following axiom: 
% \begin{gather}
%   \oax{\rst(a_{1}, a_{2})}(c)\label{eq:links-assertion} 
% \end{gather}
% % This is slightly more complicated as we mapped the
% %   relationship types between the players:
% % \begin{gather}
% %   (\oax{\rst(o_{1}, o_{2})}\sqcap\oax{\plays(o_{1}, a_{1})}\sqcap\oax{\plays(o_{2},
% %     a_{2})})(c)\label{eq:links-assertion} 
% % \end{gather}
% %where w.l.o.g.\ $o_{1}, o_{2}\in\OI\setminus\IND$ are fresh individual names.

\subsection{A Mapping for the \texorpdfstring{\SCROC{} \Cmc}{Sigma-CROC C}}
\label{sec:mapping-constraints}


Let \Cmc be a \SCROC, let $\RG(\Cmc)$ denote the set of all complex \rosirole groups occurring in
\Cmc and let $\RG*(\Cmc) \subseteq \RG(\Cmc)$ denote the set of all complex top-level \rosirole
groups. 

\begin{enumerate}

\item Analogous to \rosiroles, \rosirole groups are disjoint, every instance of a \rosirole group
must be played by some object and every object can either fulfill or not fulfill a \rosirole group.
\begin{align}
  \top & \sqsubseteq \oax{ \Arg \equiv \bigsqcup_{\rg\in\RG(\Cmc)}\rg} 
      \sqcap \bigsqcap_{\substack{\rg[1],\,\rg[2]\in\RG(\Cmc),\\ \rg[1]\neq\rg[2]}} 
      \oax{\rg[1] \sqcap \rg[2] \sqsubseteq \bot}
      \label{eq:rolegroups-coverage-and-disjoint}\\
  \top & \sqsubseteq \oax{\Arg \sqsubseteq \atleast{1}{\plays^{-}}{\top} 
      \sqcap \atmost{1}{\plays^{-}}{\top}}\label{eq:rgs-exactly-one-inverse-plays} \\
  \top & \sqsubseteq \bigsqcap_{\rg\in\RG(\Cmc)} \oax{\Ant \sqsubseteq \atmost{1}{\plays}{\rg}}\label{eq:obj-plays-max-one-rg}
\end{align}

\item Complex \rosirole groups are treated like abstract \rosiroles. An object can ``play'' an instance of
a \rosirole group. This is equivalent to fulfilling that role group. So, the object must ``play''
the required number of containing \rosirole groups.
%
Furthermore, if an object plays a \rosirole whose type is an atom of a top-level \rosirole group,
the object must also fulfill that \rosirole group.
\begin{align}
  \top & \sqsubseteq \bigsqcap_{\substack{\rg\in\RG(\Cmc),\\\rg = (\{A_{1}, \dots, A_{n}\},k,\ell)}}
      \oaxl{\exists\plays.\rg \equiv }
  \begin{aligned}[t]
    & (\atleast{k}{\plays}{(A_{1} \sqcup \dots \sqcup A_{n})}) \\
    &  \quad \sqcap \oaxr{(\atmost{\ell}{\plays}{(A_{1} \sqcup \dots \sqcup A_{n})})}
  \end{aligned}\label{eq:rg-declaration}\\
  \top & \sqsubseteq \bigsqcap_{\rg\in\RG*(\Cmc)}
      \oax{\exists\plays.\bigg(\bigsqcup\nolimits_{\rt\in\atom(\rg)}\rt\bigg)\sqsubseteq \exists\plays.\rg}\label{eq:rg-must-play}
\end{align}

\item Since for the occurrence constraints we only consider objects that play any \rosirole in this
compartment, we assure that fulfilling a \rosirole group implies playing some \rosirole.
\begin{align}
  \top & \sqsubseteq \oax{\exists\plays.\Arg\sqsubseteq\exists\plays.\Art}\label{eq:rgplayer-plays-role}
\end{align}

\item To capture the occurrence constraints we use an object individual name \occurCounter and introduce
an \counts-role from that individual to all \rosiroles and \rosirole group instances. Thus, the
occurrence constraints can be enforced with the help of qualified number restrictions.
\begin{align}
  \top & \sqsubseteq \oax{\Art \sqcup \Arg \sqsubseteq \atleast{1}{\counts^{-}}{\{\occurCounter\}} 
      \sqcap \atmost{1}{\counts^{-}}{\{\occurCounter\}}}\label{eq:counts-decl}\\
  \begin{split}
    \ct & \sqsubseteq \oax{(\atleast{k}{\counts}{\rg})(\occurCounter)}
    \sqcap \oax{(\atmost{\ell}{\counts}{\rg})(\occurCounter)}\\
    & \text{\rlap{\hspace{5em} for all $(k..\ell,\rg)\in\occur(\ct)$, for all $\ct\in\CT$}}
  \end{split}\label{eq:occurrence-constraints}
\end{align}

\item Cardinality constraints restrict the number of \rosiroles that are related to \rosirole via a
relationship type. \Rosiroles whose type is the domain or range of a relationship type \rst for
which there exists a cardinality constraint must have the correct amount of \rst successors or
predecessors, respectively.

\begin{align}
  \top & \sqsubseteq \bigsqcap_{\substack{\rst\in\RST, \\ \rel(\rst) = (\rt[1], \rt[2]), \\
  \card(\rst) = (i..j, k..\ell)}}
  \begin{aligned}[t]
    & \oax{\exists\plays.\rt[1] \sqsubseteq \atleast{k}{\rst}{\top} \sqcap \atmost{\ell}{\rst}{\top}} \\
    & \qquad\qquad \sqcap \oax{\exists\plays.\rt[2] \sqsubseteq \atleast{i}{\rst^{-}}{\top} \sqcap \atmost{j}{\rst^{-}}{\top}}
  \end{aligned}
   \label{eq:last-equation}
\end{align}

\item As mentioned above, because we spanned the relationship types between the players and not between the
\rosiroles, we can model at least some of the intra-relationship type constraints, exactly those
that are expressible in the object logic. In \SHOIQ, these would be transitivity and symmetry. Thus,
we add the following role axioms to the object RBox \RO:
\begin{gather}
  \trans{\rst}  \text{\qquad for all $\transsf\in\intra(\rst)$}\label{eq:rbox-1}\\
  \rst \sqsubseteq \rst^{-} \text{\qquad for all $\symm\in\intra(\rst)$}\label{eq:rbox-2}
\end{gather}
where $\transsf$ and $\symm$ are functions that return $\true$ if and only if the binary relation,
respectively, is transitive or symmetric.  But it is important to note, due to the restriction that
only simple roles are allowed to appear in number restrictions, we cannot impose any cardinality
constraints on the relationship type \rst if \rst is supposed to be transitive.

\end{enumerate}
% Analogous to \rosiroles, \rosirole groups are disjoint, every instance of a \rosirole group
% must be played by some object and every object can either fulfill or not fulfill a \rosirole group.
% \begin{align}
%   \top & \sqsubseteq \oax{ \Arg \equiv \bigsqcup_{\rg\in\RG(\Cmc)}\rg} 
%       \sqcap \bigsqcap_{\substack{\rg[1],\,\rg[2]\in\RG(\Cmc),\\ \rg[1]\neq\rg[2]}} 
%       \oax{\rg[1] \sqcap \rg[2] \sqsubseteq \bot}
%       \label{eq:rolegroups-coverage-and-disjoint}\\
%   \top & \sqsubseteq \oax{\Arg \sqsubseteq \atleast{1}{\plays^{-}}{\top} 
%       \sqcap \atmost{1}{\plays^{-}}{\top}}\label{eq:rgs-exactly-one-inverse-plays} \\
%   \top & \sqsubseteq \bigsqcap_{\rg\in\RG(\Cmc)} \oax{\Ant \sqsubseteq \atmost{1}{\plays}{\rg}}\label{eq:obj-plays-max-one-rg}
% \end{align}

% \noindent
% Complex \rosirole groups are treated like abstract \rosiroles. An object can ``play'' an instance of
% a \rosirole group. This is equivalent to fulfilling that role group. So, the object must ``play''
% the required number of containing \rosirole groups.
% %
% Furthermore, if an object plays a \rosirole whose type is an atom of a top-level \rosirole group,
% the object must also fulfill that \rosirole group.
% \begin{align}
%   \top & \sqsubseteq \bigsqcap_{\substack{\rg\in\RG(\Cmc),\\\rg = (\{A_{1}, \dots, A_{n}\},k,\ell)}}
%       \oax{\exists\plays.\rg \equiv (\atleast{k}{\plays}{(A_{1} \sqcup \dots \sqcup A_{n})}) 
%       \sqcap (\atmost{\ell}{\plays}{(A_{1} \sqcup \dots \sqcup A_{n})})}\label{eq:rg-declaration}\\
%   \top & \sqsubseteq \bigsqcap_{\rg\in\RG*(\Cmc)}
%       \oax{\exists\plays.\bigg(\bigsqcup\nolimits_{\rt\in\atom(\rg)}\rt\bigg)\sqsubseteq \exists\plays.\rg}\label{eq:rg-must-play}
% \end{align}

% \noindent 
% Since for the occurrence constraints we only consider objects that play any \rosirole in this
% compartment, we assure that fulfilling a \rosirole group implies playing some \rosirole.
% \begin{align}
%   \top & \sqsubseteq \oax{\exists\plays.\Arg\sqsubseteq\exists\plays.\Art}\label{eq:rgplayer-plays-role}
% \end{align}

% \noindent
% To capture the occurrence constraints we use an object individual name \occurCounter and introduce
% an \counts-role from that individual to all \rosiroles and \rosirole group instances. Thus, the
% occurrence constraints can be enforced with the help of qualified number restrictions.
% \begin{align}
%   \top & \sqsubseteq \oax{\Art \sqcup \Arg \sqsubseteq \atleast{1}{\counts^{-}}{\{\occurCounter\}} 
%       \sqcap \atmost{1}{\counts^{-}}{\{\occurCounter\}}}\label{eq:counts-decl}\\
%   \begin{split}
%     \ct & \sqsubseteq \oax{(\atleast{k}{\counts}{\rg})(\occurCounter)}
%     \sqcap \oax{(\atmost{\ell}{\counts}{\rg})(\occurCounter)}\\
%     & \text{\rlap{\hspace{5em} for all $(k..\ell,\rg)\in\occur(\ct)$, for all $\ct\in\CT$}}
%   \end{split}\label{eq:occurrence-constraints}
% \end{align}

% \noindent Cardinality constraints restrict the number of \rosiroles that are related to \rosirole via a
% relationship type. \Rosiroles whose type is the domain or range of a relationship type \rst for
% which there exists a cardinality constraint must have the correct amount of \rst successors or
% predecessors, respectively.

% \begin{align}
%   \top & \sqsubseteq \bigsqcap_{\substack{\rst\in\RST, \\ \rel(\rst) = (\rt[1], \rt[2]), \\
%   \card(\rst) = (i..j, k..\ell)}}
%   \begin{aligned}[t]
%     & \oax{\exists\plays.\rt[1] \sqsubseteq \atleast{k}{\rst}{\top} \sqcap \atmost{\ell}{\rst}{\top}} \\
%     & \qquad\qquad \sqcap \oax{\exists\plays.\rt[2] \sqsubseteq \atleast{i}{\rst^{-}}{\top} \sqcap \atmost{j}{\rst^{-}}{\top}}
%   \end{aligned}
%    \label{eq:last-equation}
% \end{align}

% \noindent
% As mentioned above, because we spanned the relationship types between the players and not between the
% \rosiroles, we can model at least some of the intra-relationship type constraints, exactly those
% that are expressible in the object logic. In \SHOIQ, these would be transitivity and symmetry. Thus,
% we add the following role axioms to the object RBox \RO:
% \begin{gather}
%   \trans{\rst}  \text{\qquad for all $\transsf\in\intra(\rst)$}\label{eq:rbox-1}\\
%   \rst \sqsubseteq \rst^{-} \text{\qquad for all $\symm\in\intra(\rst)$}\label{eq:rbox-2}
% \end{gather}
% where $\transsf$ and $\symm$ are functions that return $\true$ if and only if the binary relation,
% respectively, is transitive or symmetric.  But it is important to note, due to the restriction that
% only simple roles are allowed to appear in number restrictions, we cannot impose any cardinality
% constraints on the relationship type \rst if \rst is supposed to be transitive.

\subsection{Semantic Integrity of Mapping Algorithm}
\label{sec:sem-integ-mapping}

Before we establish the desired relation between the CROM and the ontology, we do a short analysis
of the required expressiveness of the meta and the object logic. To state the disjoint union axioms
we need at least~\ALC. As we do not need anything more on the meta level, we can fix~\LM to
be~\ALC. On the object level, we need qualified number restrictions and inverse roles to assure that
every \rosirole is played exactly once.
%Hence, the minimal object DL is \ALCIQ. 
If we have a single occurrence constraint, we have to add nominals. Transitivity axioms or role
hierarchies are only required if some intra-relationship type constraint specifies a transitive or
symmetric relationship type, respectively. Table~\ref{tab:required-dls} shows a summary of the
required DLs.

Anyhow, from a practical point of view not only the required DLs are relevant but also the
complexity of the reasoning. Besides the specific DL it is also important which names in the
ontology need to be rigid. We need rigid concept names for mapping natural types and o-compartment
types. Whether we also need rigid role names depends on the constraints we want to model. Rigid
roles are necessary to model attributes of natural types, e.g.\ the name or date of birth of a
person. Complexity-wise it is important to only map details of the role-based model which might have
logical implications.  Since in the current version of CROM we do not have any constraints based on
attributes of naturals, we will not map attributes and, hence, do not need rigid roles.  In
Section~\ref{sec:going-beyond-crom}, we analyse some constraints beyond CROM which we can model in
\LMLO and therefore we also need rigid roles. Table~\ref{tab:crom-complexity} shows an overview of
the resulting complexities. Note here, that these are all worst-case complexities and that the
actual reasoning effort might vary depending on the used constraints even if the different cases,
i.e.\ with and without intra-relationship type constraints, are in the same complexity class.


Given a \SCCROM{} \Kmc, we obtain the \ALCSHOIQ ontology
$\Bmf_{\Kmc} = (\Bmc_{\Kmc}, \emptyset,\RO)$ where~$\Bmc_{\Kmc}$ is the conjunction of all meta
axioms from~\eqref{eq:compartments-coverage} to~\eqref{eq:last-equation} and~\RO is the set of all
role axioms~\eqref{eq:rbox-1} and~\eqref{eq:rbox-2}.


\setlength{\floatsep}{25pt plus 2.0pt minus 2.0pt}
\begin{table}
  \caption{Summary of required DLs for \LM and \LO.}
  \label{tab:required-dls}  \centering
  \begin{tabularx}{0.9\linewidth}{lXl}
    \toprule
    \LO & minimal                                  & \ALCIQ\\
        & with occurrence constraints              & \ALCOIQ\\
        & with intra-relationship type constraints & \SHOIQ\\
    \midrule
    \LM & & \ALC\\
    \bottomrule
  \end{tabularx}
\end{table}

\begin{table}
  \caption{ Overview of complexities for reasoning on CROM models with (I): No attribute-based
    constraints (only rigid concepts), and (II): With attribute-based constraints (with rigid roles).}
  \label{tab:crom-complexity}  \centering
  \begin{tabularx}{0.9\linewidth}{M{8mm}LLL}
    \toprule
    & minimal (\ALCALCIQ)
    & with occ.\ constr.\ (\ALCALCOIQ)
    & with in.-rel.\ constr.\ (\ALCSHOIQ) \\
    \midrule
    (I)  & \NExpTime   & \multicolumn{2}{c}{\NExpTime-hard and in \TwoNExpTime}\\
    (II) & \TwoExpTime & \multicolumn{2}{c}{\TwoExpTime-hard and in \TwoNExpTime}\\
    \bottomrule
  \end{tabularx}
\end{table}
%\setlength{\floatsep}{12pt plus 2.0pt minus 2.0pt}

\begin{theorem}
  Let $\Kmc = (\Mmc, \Amc, \Cmc)$ be a \SCCROM. Then, \Kmc is satisfiable iff $\Bmf_{\Kmc}$ is consistent.
\end{theorem}
\begin{proof}
  Assume that \Kmc is satisfiable and let \IK denote a \SCROI that satisfies \Mmc, \Amc and
  \Cmc.  We define the set
  $\Delta_{\RT,c}$ of all \rosiroles played in $c$,
  the set $\Delta_{\RG,c}$ of all \rosirole group instances fulfilled in $c$,  and the nested interpretation \JJ as follows:
  \begin{align*}
    \Delta_{\RT,c} & \coloneqq \{r\in\Rsf[\IK] \mid (\cdot,c,r) \in\plays\} \text{\qquad for all $c\in\Csf[\IK]$}\\
    \Delta_{\RG,c} & \coloneqq \{(x,c,y) \in \RG\times\Csf[\IK]\times\Osf[\IK] \mid x^{\IK,c,y}=1\} \text{\qquad for all $c\in\Csf[\IK]$}\\[1ex]
    \Cbb & \coloneqq \Csf[\IK] \\
    \ct^{\J} & \coloneqq \ct^{\IK} \text{\qquad for all $\ct\in\CT$} \\
    \nested^{\J} & \coloneqq \{(c,o) \mid o,c\in\Csf[\IK], (o,c,\cdot)\in\plays\} \\[1ex]
    \Delta^{\J} & \coloneqq \Nsf[\IK] \cup \Csf[\IK] \cup \Rsf[\IK] \cup \bigcup_{c\in\Csf[\IK]}\Delta_{\RG,c} \cup \{d_{\occurCounter}\}\\
    \nt^{\I_{c}} & \coloneqq \nt^{\IK} \text{\qquad for all $\nt\in\NT$} \\
    \ct*^{\I_{c}} & \coloneqq \ct^{\IK} \text{\qquad for all $\ct\in\CT$} \\
    \rt^{\I_{c}} & \coloneqq \rt^{\IK} \cap \Delta_{\RT,c} \text{\qquad for all $\rt\in\RT$} \\
    \rg^{\I_{c}} & \coloneqq \{(\rg,c,y) \mid \rg^{\IK,c,y}=1\} \text{\qquad for all $\rg\in\RG(\Cmc)$}\\
    \Art^{\I_{c}} & \coloneqq \Delta_{\RT,c}\\
    \Ant^{\I_{c}} & \coloneqq \Osf[\IK]\\
    \Arg^{\I_{c}} & \coloneqq \Delta_{\RG,c}\\
    \rst^{\I_{c}} & \coloneqq \{(o_{1},o_{2})\mid\text{ there are $r_{1}$, $r_{2}$ s.t.\
                    $(o_{1},c,r_{1}),(o_{2},c,r_{2})\in\plays$ and}\\
                   & \hspace{3cm}\text{$(r_{1},r_{2})\in\links(\rst,c)$}\}\\
    \plays^{\I_{c}} & \coloneqq \{(o,r) \mid (o,c,r)\in\plays\}\\
                   &\hspace{3cm} \cup \{(o,r{\kern-0.1em}g) \mid r{\kern-0.1em}g =
                     (x,c,o)\in\Delta_{\RG,c}\text{ with $x^{\IK,c,o}=1$}\}\\
    \counts^{\I_{c}} & \coloneqq \{(d_{\occurCounter},y) \mid y\in\Delta_{\RT,c}\cup\Delta_{\RG,c}\}\\
    \occurCounter^{\I_{c}} & \coloneqq d_{\occurCounter}\\
    c^{\J} & \coloneqq c^{\IK} \text{\qquad for $c\in\INDC$}\\
    a^{\I_{c}} & \coloneqq a^{\IK} \text{\qquad for $a\in\IND$}
  \end{align*}
  It is straight forward to show that \J is a model of $\Bmf_{\Kmc}$. Note, that \J respects the
  rigid names since all \nt, \ct*, \Ant and individual names are interpreted the same in every
  world~$c$.
  %
  Axioms~\eqref{eq:compartments-coverage},
  \eqref{eq:compartments-disjoint},
  \eqref{eq:naturals-coverage},
  \eqref{eq:roles-disjoint},
  \eqref{eq:obj-disjoint},
  \eqref{eq:plays-domain},
  \eqref{eq:plays-range},
  \eqref{eq:meta-type-assertion} to~\eqref{eq:obj-plays-max-one-rg},
  \eqref{eq:counts-decl}
  %
  are modelled by construction of \J. Since
  $\Delta_{\RT,c}\subseteq\bigcup_{\rt\in\RT}\rt^{\IK} = \Rsf[\IK]$, \J models \eqref{eq:roles-coverage}.
  %
  Axioms~\eqref{eq:roletype-played-max-once} and~\eqref{eq:role-is-played-exactly-once} are modelled due
  to 3. and 4. of Definition~\ref{def:scroi}. 
  %
  Assume that $c_{1}\in(\lnot\oax{\ct* \sqcap \exists\plays.\top\sqsubseteq\bot})^{\J}$. Hence,
  $\I_{c_{1}}\not\models\ct* \sqcap \exists\plays.\top\sqsubseteq\bot$. Thus, there exists
  $c_{2}\in(\ct* \sqcap \exists\plays.\top)^{\I_{c_{1}}}$. Therefore,
  $(c_{2},c_{1},\cdot)\in\plays$, $(c_{1},c_{2})\in\nested^{\J}$ and $c_{2}\in\ct^{\J}$. Overall, \J
  models Axiom~\eqref{eq:nested-cts}.
  %
  Since \plays respects \fills and \parts, and \links respects \rel, \eqref{eq:fills},
  \eqref{eq:roles-in-compartment} and \eqref{eq:rst-domain-range} are satisfied.
  %
  Axioms~\eqref{eq:rg-declaration} to~\eqref{eq:rgplayer-plays-role} are satisfied due to the
  semantics of \rosirole groups and the fact that all top-level \rosirole groups are satisfied.
  %
  \IK respecting occurrence and cardinality constraints ensures that \J
  models~\eqref{eq:occurrence-constraints} and~\eqref{eq:last-equation}. 
  %
  Finally, the respective intra-relationship constraints imply the satisfaction of \RO.
  
  Conversely, let \JJ denote a model of $\Bmc_{\Kmc}$. W.l.o.g. we can assume that all
  o-compartments that exist also play some \rosiroles. Otherwise we could simply delete them, and
  still have a model. 
  %
  Let $\Delta_{\NT}\subseteq\Delta^{\J}$ and $\Delta_{\CT}\subseteq\Delta^{\J}$ denote,
  respectively, the set of all naturals and the set of all o-compartments, i.e.
  \begin{align*}
    \Delta_{\NT} & \coloneqq \bigcup_{\nt\in\NT} \nt^{\I_{\hat{c}}} \text{, and}\\
    \Delta_{\CT} & \coloneqq \bigcup_{\ct*\in\CT*} \ct*^{\I_{\hat{c}}}
  \end{align*}
  for some $\hat{c}\in\Cbb$.
  %
  Due to \eqref{eq:nested-cts}, there exists a mapping $\mu: \Delta_{\NT}\cup\Delta_{\CT} \to \Delta_{\NT}\cup\Cbb$ which maps
  o-compartments to contexts of respective type, i.e.
  \begin{align*}
    \mu(o) \coloneqq
    \begin{cases}
      o & \text{if $o\in\Delta_{\NT}$, and} \\
      c \text{ such that $c\in\ct^{\J}$} & \text{if $o\in\ct*^{\I_{\hat{c}}}$}.
    \end{cases}
  \end{align*}
W.l.o.g, we can assume that there exist
  sufficiently many contexts $c\in\Cbb$ to assure that $\mu$ preserves the occurrence and
  cardinality constraints, since we could introduce copies of $c$ if necessary.  We define the
  \SCROI{} \I as follows:
  \begin{align*}
    \Gamma^{\I} & \coloneqq \Cbb^{\J} \cup \Delta_{\NT} \cup \bigcup_{c\in\Cbb} \Art^{\I_{c}}\\
    \type(d) & \coloneqq  
               \begin{cases}
                 T & \text{if $T\in\CT$ and $d\in T^{\J}$}\\
                 T & \text{if $T\in\NT\cup\RT$ and $d\in T^{\I_{c}}$ for some $c$}
               \end{cases}\\
    (\mu(o),c,r) \in \plays & \text{\quad iff \quad $(o,r)\in\plays^{\I_{c}}$}\\
    (r_{1}, r_{2}) \in \links(\rst,c) & \text{\quad iff \quad $(o_{1},r_{1}), (o_{2},r_{2}) \in
                                        \plays^{\I_{c}}$ and $(o_{1}, o_{2})\in\rst^{\I_{c}}$}
  \end{align*}
  \I is well-defined and analogous to above one can go through the axioms step by step and show that
  \I satisfies \Kmc, e.g.\ Axiom~\eqref{eq:roles-in-compartment} ensures that \plays respects \parts
  in \I.
\end{proof}

Let us consider once again Example~\ref{ex:bank-crom} and Figure~\ref{fig:bank} to analyse some
implications which can be drawn due to the mapping into description logics.

\begin{example}
  Instead of writing down all axioms of the respective ontology $\Omc_{\Bank}$, we will rather point
  out some interesting inferences. At first we have a look at the \Bank compartment type, the
  \rosirole group \BankAccounts, the relationship types \ownca and \ownsa and the \rosirole type
  \Customer.

  Omitting general axioms, e.g.\ stating that every role or rolegroup instance is played and
  connected to \occurCounter, the following axioms are contained in the ontology, among others:
  \begin{align}
    % \top & \sqsubseteq \oax{\BankAccounts\sqsubseteq\exact{1}{\plays^{-}}{\top}}\\
    \Bank & \sqsubseteq \oax{(\atleast{1}{\counts}{\BankAccounts})(\occurCounter)}\label{eq:counter-bankaccount}\\
    \begin{split}
      \top & \sqsubseteq \oaxl{\exists\plays.\BankAccounts \equiv \atleast{1}{\plays}{(\CheckingAccount\sqcup\SavingsAccount)}}\\
      & \qquad\qquad \sqcap \oaxr{\atmost{1}{\plays}{(\CheckingAccount\sqcup\SavingsAccount)}}
    \end{split}\label{eq:decl-rg-bankaccounts}\\
    \top & \sqsubseteq \oax{\SavingsAccount\sqsubseteq\atleast{1}{\ownsa^{-}}{\top}}\label{eq:card-ownsa}\\
    \top & \sqsubseteq \oax{\CheckingAccount\sqsubseteq\atleast{1}{\ownca^{-}}{\top}}\label{eq:card-ownca}\\
    \top & \sqsubseteq \oax{\exists\ownsa.\top\sqsubseteq\Customer}\label{eq:domain-ownsa}\\
    \top & \sqsubseteq \oax{\exists\ownca.\top\sqsubseteq\Customer}\label{eq:domain-ownca}
  \end{align}
  In any interpretation \J that satisfies $\Omc_{\Bank}$ with $c\in\Bank^{\J}$,
  equations~\eqref{eq:counter-bankaccount} and~\eqref{eq:decl-rg-bankaccounts} entail the existence
  of an element in $\CheckingAccount^{\I_{c}}$ or $\SavingsAccount^{\I_{c}}$. Due to
  \eqref{eq:card-ownsa} and \eqref{eq:card-ownca}, there must be some element ``owning a CA or SA'',
  which must be in $\Customer^{\I_{c}}$ (\eqref{eq:domain-ownsa}
  and~\eqref{eq:domain-ownca}). Hence, the following axiom can be entailed:
\begin{align}
  \Bank & \sqsubseteq \oax{(\atleast{1}{\counts}{\Customer})(\occurCounter)},\label{eq:counter-customer}
\end{align}
stating that the occurrence constraint for \Customer is essentially $1..*$. For the
\Transaction compartment type we have:
\begin{align}
  \Transaction & \sqsubseteq \oax{(\atleast{1}{\counts}{\Participants} \sqcap
                 \atmost{1}{\counts}{\Participants})(\occurCounter)}\label{eq:counter-participants}\\
  \begin{split}
    \top & \sqsubseteq\oaxl{\exists\plays.\Participants \equiv
      \atleast{1}{\plays}{(\Source\sqcup\Target)}}\\
    & \qquad\qquad \sqcap \oaxr{\atmost{1}{\plays}{(\Source\sqcup\Target)}}
  \end{split}\label{eq:decl-rg-participants}\\
  \begin{split}
    \top & \sqsubseteq \oax{\Source \sqsubseteq \atleast{1}{\transBank}{\top} \sqcap
      \atmost{1}{\transBank}{\top}}\\
    & \qquad\qquad \sqcap \oax{\Target \sqsubseteq \atleast{1}{\transBank^{-}}{\top} \sqcap
      \atmost{1}{\transBank^{-}}{\top}} 
  \end{split}\label{eq:card-trans}\\
   \top & \sqsubseteq \oax{\exists\transBank.\top\sqsubseteq\Source} \sqcap \oax{\exists\transBank^{-}.\top\sqsubseteq\Target}\label{eq:domain-range-trans}
\end{align}
Assume that there would be some $d\in\Transaction^{\J}$.  By~\eqref{eq:counter-participants}
and~\eqref{eq:decl-rg-participants}, we know that there exists exactly one element in
$\Source^{\I_{d}}$ or $\Target^{\I_{d}}$. But due to~\eqref{eq:card-trans}
and~\eqref{eq:domain-range-trans}, there must also be an element in $\Target^{\I_{d}}$ or
$\Source^{\I_{d}}$, respectively. This results in two elements in $\Participants^{\I_{d}}$ which
contradicts~\eqref{eq:counter-participants}. Thus,
\begin{align}
  \Transaction & \sqsubseteq \bot\label{eq:transaction-bottom}
\end{align}
is entailed. Actually, the occurrence constraints for \Participants should be $2..2$.  Back to the
\Bank compartment, we also have
\begin{align}
  \top & \sqsubseteq \oax{\Customer\sqsubseteq\atleast{1}{\issues}{\top}}\label{eq:card-issues}\\
  \top & \sqsubseteq \oax{\exists\issues^{-}.\top\sqsubseteq\MoneyTransfer}\label{eq:range-issues}\\
  \top & \sqsubseteq \oax{\exists\plays.\MoneyTransfer\sqsubseteq\Transaction'}\label{eq:fills-moneytransfer}\\
  & \mathllap{\lnot}\oax{\Transaction'\sqcap\exists\plays.\top\sqsubseteq\bot} \sqsubseteq \exists\nested.\Transaction\label{eq:nested-transaction}
\end{align}
Due to~\eqref{eq:counter-customer},~\eqref{eq:card-issues} and~\eqref{eq:range-issues}, there must
be some element in $\MoneyTransfer^{\I_{c}}$ which must be $\mathsf{play}$ed by an element in
$\Transaction'^{\I_{c}}$. Thus, by~\eqref{eq:nested-transaction} we have to have some context
$c_{2}$ connected to $c$ via \nested with $c_{2}\in\Transaction$. But that
contradicts~\eqref{eq:transaction-bottom}.

Overall, the banking example is indeed inconsistent, due to a small modelling error in some
occurrence constraints within one compartment type that makes the whole domain model unsatisfiable.
\end{example}


Besides checking satisfiability in general, we can also address the following other questions a
domain analyst would be interested in:
\begin{enumerate}
\item[(Q1)] Is a specific compartment type \ct instantiable, i.e.\ does there exist some \SCROI{} \I
  s.t.\ there exists a compartment $c$ with $c \in \ct^{\I}$?
\item[(Q2)] Is the \rosirole type \rt playable, i.e.\ does there exist some \SCROI{} \I s.t. there is
  some $r \in \rt^{\I}$?
\item[(Q3)] Can two \rosiroles be linked via the relationship type \rst, i.e. does there exist some
  \SCROI{} \I s.t. there are some $r_{1}, r_{2}\in \Rsf$, $c\in \Csf$ with
  $\links(\rst,c)=(r_{1}, r_{2})$?
\item[(Q4)] Can more precise constraints be entailed, i.e.\ do there exist some cardinalities in \Cmc
  which can never be reached?
\item[(Q5)] Is some partial knowledge about an instance satisfiable, i.e.\ does there exist some
  \SCROI{} \I based on this partial knowledge?
\end{enumerate}

To answer all these questions, we utilise \SCROA{s} as introduced earlier. For~(Q1), we add the meta
type assertion
\begin{gather*}
  \ct(a) 
\end{gather*}
to \A and check $\Bmf_{(\Mmc,\A,\Cmc)}$ for consistency. To answer~(Q2), an object type assertion of
the form
\begin{gather*}
  \rt(a,c), 
\end{gather*}
added to \A, is sufficient. W.l.o.g. we assume that $a$ and $c$ do not occur in
$\Bmf_{(\Mmc,\A,\Cmc)}$ before. Due to the other axioms already specified, the \rosirole must also
be played.
%
Similarly, for~(Q3) we add the link assertion
\begin{gather*}
  \linkass(\rst, c, a_{1}, a_{2}).
\end{gather*}
To test whether constraints are sharp, we assert the opposite and check for inconsistency. Here, we
will directly add axioms to $\Bmf_{(\Mmc,\A,\Cmc)}$. If, for example, there must exist at least $n$
roles of type \rt in \ct, we add
\begin{gather*}
  \ct \sqsubseteq \oax{(\atmost{n}{\counts}{\rt})(\occurCounter)} \land \ct(a)
\end{gather*}
to $\Bmf_{(\Mmc,\A,\Cmc)}$ which states that there must also exist at most $n$ \rt-roles. Then,
inconsistency of $\Bmf_{(\Mmc,\A,\Cmc)}$ would imply that there must indeed exist $n+1$ \rt-roles in
\ct.

For~Q5, we assume that we know certain facts about the domain. This could be the existence of a
compartment, a role or a link between two roles. These can all be formulated via a \SCROA, with
individual names adjusted accordingly.  If adding all respective assertions still preserves
consistency of $\Bmf_{(\Mmc,\A,\Cmc)}$, then there exists some \SCROI that satisfies \Mmc, \A and
\Cmc and respects these facts.


\section{Going beyond \texorpdfstring{$\Sigma$}{Sigma}-CROMs}
\label{sec:going-beyond-crom}

In~\cite{KuLG-SLE14}, Kühn et al. present a feature model for role-based modelling languages of
which the above defined CROM is one instance.  To support other variants of role-based models, the
same basic ideas of our mapping can be applied.  However, a detailed analysis which features can
easily be supported, is necessary.  The first feature that we will discuss is inheritance.

Let us assume, that additionally to a CROM we also have an irreflexive, asymmetric, functional
inheritance relation $\prec_{\nt}$ over the natural types. Inheritance is intuitively captured as a
GCI:
\begin{align}
  \label{eq:1}
  \top \sqsubseteq & \oax{\nt[a] \sqsubseteq \nt[b]} \text{ for all $\nt[a]\prec_{\nt}\nt[b]$}.
\end{align}
Then, obviously we have to adjust axiom~\eqref{eq:roles-disjoint} since natural types do not need to
be disjoint anymore. This implies that if some natural type \nt fills a role type \rt, then every
subtype of \nt also fills \rt.  Similarly, inheritance for compartment types could be handled.
Here, one has to make sure what exactly the intended semantics of compartment inheritance is
supposed to be. In our setting, a compartment subtype would be a specialization in the sense that
all axioms and constraints that hold for the supertype also hold for the subtype but there could
exist additional axioms or constraints in the subtype.

Some features in the feature model handle behaviour and dynamic aspects of role-based models. These
are not relevant in our case, as they have no influence on satisfiability. The same holds for
features about the ontological identity of roles and compartments.
%
All other features can easily be supported since only little changes to the mapping are required. These
include, among others, deep \rosiroles, i.e. \rosiroles which are allowed to play \rosiroles, or
whether a \rosirole type can be played several times by one object in the same compartment.


% \subsection{Adding Inheritance}
% \label{sec:adding-inheritance}

% Let us assume, that additionally to a CROM we also have an inheritance relation $\prec_{\nt}$ over
% the natural types.

% \todo[inline]{introduction paragraph}

% \todo[inline]{natural type inheritance - what is important in this setting}

% In the last sections we showed how contextualised description logics can represent \rosirole-based models

% \subsection{Further Features}
% \label{sec:further-constraints}


% \subsection{Going beyond CROM}
% \label{sec:temporal-aspects}

Two kinds of constraints that, in our opinion, might be important in practice, were not considered
until now: Constraints based on attributes of players and temporal constraints.

The first ones are quite easy to express in \LMLO. Besides some technical changes on the above
axioms, for each attribute $\mathsf{att_{i}}$ of a natural type or o-compartment, we introduce the
rigid role $\mathsf{att_{i}}\in\ORR$, since we assume that attributes of a rigid type are also
rigid.  Here, it might even be worth considering a description logic with concrete
domains~\cite{Lutz-PHD02,Lut-AiML02} as the object logic. We did not investigate these extensions of
DLs, but we conjecture that all results of Chapter~\ref{cha:context-dls} can be transferred without
much effort.

By utilising rigid types which are modelled with more detail, we can also introduce more fine-grained
constraints. For example, the \fills-relation could be specified to not only require a player of a
certain \rosirole type to be of some specific natural type but rather to demand that certain
attributes must exist. To be allowed to ``play'' the \rosirole of an employee, a person must have a
tax ID. Going a step further, we could also restrict \rosirole-playing based on the values of the
attributes. In the context of USA, a person can only play president if he is a ``natural born
citizen'' and at least 35 years old:
\begin{align*}
  \mathsf{USA} \sqsubseteq\oax{\exists\plays.\mathsf{President} \sqsubseteq \mathsf{Person} \sqcap
  \exists \mathsf{natural\_born\_citizen}.\{\true\} \sqcap \exists\mathsf{age \geq_{35}}}.
\end{align*}

Last but not least we can express additional complex constraints with arbitrary \LMLO axioms. For
example,
\begin{align*}
  \oax{\exists\rst.(\exists\rst.\top)\sqsubseteq\bot} \sqsubseteq \oax{\exists\rst.\top\sqsubseteq\bot}
\end{align*}
states that if there are no chains of length two for an relationship type \rst, then there will not
be any \rst at all in that particular compartment.


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../thesis"
%%% End:
