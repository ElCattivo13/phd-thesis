
\chapter{JConHT -- A \texorpdfstring{\SHOIQSHOIQ}{SHOIQ[SHOIQ]} Reasoner}
\label{cha:jconht}

In the last chapter we presented a mapping for role-based models into contextualized description
logic ontologies. This process can be done automatically and therefore it helps the automatic
processing and investigation of role-based models. But one final step in this work flow is still
missing: a reasoner that is capable of handling these ontologies.

In this chapter we will present ...


\todo[inline]{A reasoner capable of contextualized DL ontologies}


\todo[inline]{In this chapter we only consider \LMLO ontologies instead of \LMLO-BKBs. Let \Omc be a
\SHOIQSHOIQ-BKB, let \bsf be the bijection as defined in Definition ??.}

\todo[inline]{We want to check consistency of \Omc.}

\section{A Blackbox Approach}
\label{sec:blackbox-approach}

In section \ref{sec:complexity-consis-problem} we showed that we can reduce the consistency problem
of \LMLO to two separate decision problems. Now, the general idea for an implementation is to use
existing, highly optimized and performant reasoners for these subtasks. We will discuss special
requirements for these reasoners in section \ref{sec:implementing-jconht}. \todo{correct section?}

In this section we will discuss how the two subtasks, namely admissibility of \Xmc and outer
consistency w.r.t.\ \Xmc, can be reduced to standard reasoning tasks.


\subsection{Admissibility}
\label{sec:admissibility}

In the definition of admissibility (Def. \ref{def:admissibility}), where we define $\Bmc_{X_{i}}$,
we require negated o-axioms. Negated axioms, especially negated GCIs, are usually not supported by
classical description logic reasoners. Therefore, we introduce the notion of \emph{weakly negated
  axioms}.

\begin{definition}[Weakly negated axioms]
  Let $\alpha$ be an axiom over \Nsig, then the \emph{weakly negated axiom $\alpha^{*}$} is defined
  as follows:
  \begin{itemize}
  \item if $\alpha = C \sqsubseteq D$, then $\alpha^{*} \coloneqq (C \sqcup \lnot D)(x)$ where $x$
    is a fresh variable,
  \item if $\alpha = C(a)$, then $\alpha^{*} \coloneqq (\lnot C)(a)$,
  \item if $\alpha = r(a,b)$, then $\alpha^{*} \coloneqq \lnot r(a,b)$,
  \item for all other $\alpha$, $\alpha^{*} \coloneqq \lnot \alpha$. \qedhere
  \end{itemize}
\end{definition}

Note that this definition reflects the aspect of \todo{soundness and completeness? Are these the
  correct terms here???} soundness, i.e.\ $\alpha\land\alpha^{*}$ is inconsistent, but not
completeness, i.e.~$\I\models\alpha\lor\alpha^{*}$ does not hold for all \Nsig-interpretations \I.

\begin{lemma}\label{lem:weakly-negation-inconsistent}
  Let $\alpha$ be an axiom. Then,
  \begin{enumerate}
  \item $\alpha\land\alpha^{*}$ is inconsistent, and
  \item if $\I\not\models\alpha$, then there exists an interpretation $\I'$ such that $\I'\models\alpha^{*}$.
  \end{enumerate}
\end{lemma}
\begin{proof}
  Let $\alpha = C \sqsubseteq D$ and $\alpha^{*} = (C \sqcup \lnot D)(x_{\mathsf{new}})$. Assume
  that $\I \models \alpha$ and $\I \models C(x_{\mathsf{new}})$.  Then, we know that
  ${x_{\mathsf{new}}}^{\I} \in C^{\I} \subseteq D^{\I}$. Thus we have
  ${x_{\mathsf{new}}}^{\I} \in D^{\I}$ and clearly
  ${x_{\mathsf{new}}}^{\I} \notin (C \sqcap \lnot D)^{\I}$. Hence,
  $C \sqsubseteq D \land (C \sqcap \lnot D)(x_{\mathsf{new}})$ is inconsistent.

  If $\I\not\models C \sqsubseteq D$, then there exists $d\in\Delta^{\I}$ such that
  $d \in C^{\I} \cap (\lnot D)^{\I}$. Then, the interpretation~$\I'$, equal to~\I but sets
  ${x_{\mathsf{new}}}^{\I'} \coloneqq d$, models $\alpha^{*}$.

  For the other axioms, the weakly negated axiom is defined as the normally negated axiom and the
  claim follows directly from the definition of $\models$ (see Def. \ref{def:semantics-of-axioms}).
\end{proof}

To check admissibility of a set of types, we distinguish whether or not rigid names are present. In
the latter case, i.e.\ $\OCR=\ORR=\emptyset$, condition (I) of Definition~\ref{def:admissibility} is
always fulfilled. Therefore, we can check each $\Bmf_{X_{i}}$ separately. We show that it is
sufficient to consider the weakly negated axioms.

\begin{definition}[Sets of positive and negative induced o-axioms]
  Let $\Xmc = \{X_{1}, \ldots, X_{k}\}$ be a set of restricted types. Then, the \emph{sets of
    positive induced o-axioms $\Xposi$} are defined as
  \begin{align*}
    \Xposi & \coloneqq \{\alpha \mid \bsf(\oax{\alpha})\in X_{i}\}.\\
  \intertext{The \emph{sets of negative induced o-axioms \Xnegi} are defined as}
    \Xnegi & \coloneqq \{\alpha \mid \bsf(\oax{\alpha})\in\ran(\bsf)\setminus X_{i}\}.\qedhere
  \end{align*}
\end{definition}


\begin{lemma}\label{lem:admissibility-without-rigid}
  If no rigid names are present, i.e.\ $\OCR=\ORR=\emptyset$, the set $\Xmc = \{X_{1}, \ldots, X_{k}\}$ of restricted types is
  admissible iff $\Omf_{X_{i}} = (\Omc_{X_{i}}, \RO)$ is consistent for all $1 \leq i \leq k$, where
  $\Omc_{X_{i}}$ is defined as
  \begin{align*}
    \Omc_{X_{i}}:=\bigwedge_{\alpha\in\Xposi}\alpha\ \land \bigwedge_{\alpha\in\Xnegi}\alpha^{*}.
  \end{align*}
\end{lemma}
\begin{proof}
  Assume that \Xmc is admissible. Then there exists \Osig-interpretations
  $\I_1=(\Delta,\cdot^{\I_1})$,~\dots, $\I_k=(\Delta,\cdot^{\I_k})$ such that every $\I_i$,
  $1\le i\le k$, is a model of $\Bmf_{X_{i}}$ where $\Bmf_{X_{i}}$ is defined as in
  Definition~\ref{def:admissibility}. By definition of \Xposi and \Xnegi, $\I_{i}$ is a model of
  $\smash{\bigwedge_{\alpha\in\Xposi}\alpha}$ and $\smash{\bigwedge_{\alpha\in\Xnegi}\lnot\alpha}$.
  %
  Let $\Xnegi=\{\alpha_{i,1}, \ldots, \alpha_{i,l_{i}}\}$. We have that
  $\I_{i}\models \lnot\alpha_{i,j}$ for $1 \leq j \leq l_{i}$. By Lemma
  \ref{lem:weakly-negation-inconsistent}, we get that there exists ${\I_{i}}'$ such that
  ${\I_{i}}'\models {\alpha_{i,j}}^{*}$. By induction, we get that ${\I_{i}}'\models\Omf_{X_{i}}$.

  If all $\Omf_{X_{i}}$ are consistent, there exist interpretations $\I_{i}$ such that
  $\I_{i}\models\Omf_{X_{i}}$. Then, $\I_{i}$ is a model of $\bigwedge_{\bsf(\oalpha)\in X_i}\alpha$,
  $\bigwedge_{\bsf(\oalpha)\in\ran(\bsf)\setminus X_i}\alpha^{*}$ and \RO. Due to Lemma
  \ref{lem:weakly-negation-inconsistent}, $\I'$ also models
  $\bigwedge_{\bsf(\oalpha)\in\ran(\bsf)\setminus X_i}\lnot\alpha$. Hence, $\Xmc$ is admissible.
\end{proof}

In the former case, i.e.\ $\OCR\cup\ORR\neq\emptyset$, we use the renaming approach as \hl{described in [??]}. Due to the interaction
of the rigid names, we must reason over all $\Bmf_{X_{i}}$ simultaneously. We exploit the constant
domain assumption

\todo[inline]{Explanation renaming technique}

\begin{definition}[Renamed axiom, Sets of positive and negative induced renamed o-axioms, Induced
  object ontology]
  Let $\Xmc = \{X_{1}, \ldots, X_{k}\}$ be a set of restricted types and let $\alpha$ be an axiom
  over \Osig.
  %
  For $\iota\in\nat$, the \emph{renamed axiom $\alpha^{(\iota)}$} is obtained from $\alpha$
  by replacing all flexible concept names $A$, i.e.\ $A \in \OC \setminus \OCR$, with a copy $A^{(\iota)}$
  and all flexible role names $r$ with a copy $r^{(\iota)}$ where we assume w.l.o.g.\ that $A^{(\iota)}$ and
  $r^{(\iota)}$ do not occur in \Bmf.
  
  Then, the \emph{set of positive induced renamed o-axioms \Xpos}, the \emph{set of negative induced
    renamed o-axioms \Xneg}, the \emph{renamed object RBox $\RO'$} and the \emph{induced object
    ontology $\Omc_{\Xmc}$} are defined as follows:
  \begin{align*}
    \Xpos & \coloneqq \smash{\bigcup_{i=1}^{k}}\vphantom{\bigcup_{i}}\{\alpha^{(i)} \mid \bsf(\oax{\alpha})\in X_{i}\},\\
    \Xneg & \coloneqq \bigcup_{i=1}^{k}\{\alpha^{(i)} \mid \bsf(\oax{\alpha})\in\ran(\bsf)\setminus X_{i}\},\\
    \RO' & \coloneqq \bigcup_{i=1}^{k}\{\alpha^{(i)} \mid \alpha\in\RO\} \text{, and}\\
    \Omc_{\Xmc} & \coloneqq \left(\bigwedge_{\beta\in\Xpos} \beta\ \land\ \bigwedge_{\beta\in\Xneg}
                  \beta^{*}, \quad\RO'  \right).
  \end{align*}

  \vspace{-1.7\baselineskip}
\end{definition}

Although the next lemma also holds if no rigid names are present, we state it explicitly with rigid
names, as in the other case we will use Lemma~\ref{lem:admissibility-without-rigid}.

\begin{lemma}\label{lem:admissibiliy-with-rigid}
  If rigid names are present, i.e.\ $\OCR\cup\ORR\neq\emptyset$, the set \Xmc of restricted types is
  admissible iff the induced object ontology $\Omc_{\Xmc}$ is consistent.
\end{lemma}
\begin{proof}
  If $\Omc_{\Xmc}$ is consistent, then there exists an interpretation \II such that
  $\I\models\Omc_{\Xmc}$. Let $\Xneg=\{\beta_{1}, \ldots, \beta_{l}\}$. We have that
  $\I\models{\beta_{j}}^{*}$ for $1 \leq j \leq l$. By Lemma \ref{lem:weakly-negation-inconsistent}
  we know that $\I\not\models\beta_{j}$ and, hence, $\I\models\lnot\beta_{j}$. By induction, we get
  \begin{align*}
    \I \models & \left(\bigwedge_{\beta\in\Xpos} \beta\ \land\ \bigwedge_{\beta\in\Xneg} \lnot\beta,
    \quad\RO'  \right)
  \end{align*}
  We define \Osig-interpretations $\I_1=(\Delta,\cdot^{\I_1}), \ldots, \I_k=(\Delta,\cdot^{\I_k})$
  as follows:
  \begin{align*}
    \Delta & \coloneqq \Delta^{\I},\\
    A^{\I_{i}} & \coloneqq A^{\I} \qquad \text{for all $A\in\OCR$ occurring in \Xmc,}\\
    A^{\I_{i}} & \coloneqq (A^{(i)})^{\I} \qquad \text{for all $A\in\OC\setminus\OCR$ occurring in \Xmc,}\\
    r^{\I_{i}} & \coloneqq r^{\I} \qquad \text{for all $r\in\ORR$ occurring in \Xmc,}\\
    r^{\I_{i}} & \coloneqq (r^{(i)})^{\I} \qquad \text{for all $r\in\OR\setminus\ORR$ occurring in
                 \Xmc, and}\\
    a^{\I_{i}} & \coloneqq a^{\I} \qquad \text{for all $a\in\OI$ occurring in \Xmc.}
  \end{align*}
  Condition (I) of Definition \ref{def:admissibility} is fulfilled since rigid names and individual
  names are defined the same for all $\I_{i}$.
  %
  By the definition of $\I_{i}$, we have that $\I_{i}\models\alpha$ iff
  $\I\models\alpha^{(i)}$. Hence, we know that $\I_{i}$ is a model of
  $\bigwedge_{\bsf(\oax{\alpha})\in X_{i}}\alpha$,
  $\bigwedge_{\bsf\oax{\alpha}\in\ran(\bsf)\setminus X_{i}}\lnot\alpha$ and \RO and \Xmc is
  admissible.

  If \Xmc is admissible, then there exist \Osig-interpretations $\I_1=(\Delta,\cdot^{\I_1})$,
  \ldots, $\I_k=(\Delta,\cdot^{\I_k})$ such that $x^{\I_i}=x^{\I_j}$ for all
  $x\in\OI\cup\OCR\cup\ORR$ and all $i,j\in\{1,\dots,k\}$, and every $\I_i$, $1\le i\le k$, is a
  model of the \LO-BKB $\Bmf_{X_{i}}= (\B_{X_i},\RO)$ over~\Osig where
  $\B_{X_i}:=\bigwedge_{\bsf(\oalpha)\in X_i}\alpha\ \land
  \bigwedge_{\bsf(\oalpha)\in\ran(\bsf)\setminus X_i}\lnot\alpha$. We define the
  \Osig-interpretation \II as follows:
  \begin{align*}
    \Delta^{\I} & \coloneqq \Delta,\\
    A^{\I} & \coloneqq A^{\I_{i}} \qquad \text{for $A\in\OCR$ and some $1\leq i \leq k$,}\\
    (A^{(i)})^{\I} & \coloneqq A^{\I_{i}} \qquad \text{for $A\in\OC\setminus\OCR$,}\\
    r^{\I} & \coloneqq r^{\I_{i}} \qquad \text{for $r\in\ORR$ and some $1\leq i \leq k$,}\\
    (r^{(i)})^{\I} & \coloneqq r^{\I_{i}} \qquad \text{for $r\in\OR\setminus\ORR$, and}\\
    a^{\I} & \coloneqq a^{\I_{i}} \qquad \text{for $a\in\OI$ and some $1\leq i \leq k$.}\\
  \end{align*}
  Again, by definition of \I, we have that $\I\models\alpha^{(i)}$ iff $\I_{i}\models\alpha$. Thus, we
  get that \I is a model of $\bigwedge_{\beta\in\Xpos} \beta$,
  $\bigwedge_{\beta\in\Xneg} \lnot\beta$ and $\RO'$. Due to Lemma
  \ref{lem:weakly-negation-inconsistent}, \I is also models $\bigwedge_{\beta\in\Xneg}
  \beta^{*}$. Hence, $\Omc_{\Xmc}$ is consistent.
\end{proof}




\subsection{Outer consistency}
\label{sec:outer-consistency-to-standard-reasoning}

In the decision procedures described in Section ?? \todo{} we always construct the set \Xmc first,
and then check whether \Bmfb is outer consistent w.r.t.~\Xmc. In the general case with rigid names
we enumerate all sets $\Xmc\subseteq\powerset{\ran(\bsf)}$. When only rigid concept names and no
rigid role names are present we non-deterministically guess a set \Xmc and for the case without
rigid names we construct the largest possible set \Xmc that is admissible and argue that any \Bmfb
that is outer consistent w.r.t.\ some admissible $\Xmc'$ is also outer consistent w.r.t.~\Xmc. Hence,
we only have to test outer consistency w.r.t.\ to \Xmc. But all these techniques involve the possibly
unnecessary, exponentially large construction of \Xmc.
%
Alternatively, we can also use the following lemma which is a direct consequence of
Lemma~\ref{lem:admissible-and-outerConsistent}.

\begin{lemma}
  \label{lem:consistant-and-admissible-types}
  The \LMLO-BKB \Bmf is consistent iff there is an \Msig-interpretation \Hmc such that
  $\Hmc \models \Bmfb$ and \todo{check def. of \textsf{type} in chapter 3}
  $\Zmc = \{\mathsf{type}_{\ran(b)}^{\Hmc}(d) \mid d \in \Delta^{\Hmc}\}$ is admissible.
\end{lemma}

\begin{proof}
  Let us assume that \Bmf is consistent.
  By Lemma~\ref{lem:admissible-and-outerConsistent} we know, if \Bmf is consistent than there exists
  an admissible set \Xmc such that \Bmfb is outer consistent w.r.t~\Xmc. By the definition of outer
  consistency there exists an \Msig-interpretation \Hmc that models of \Bmfb and weakly respects
  $(\ran(\bsf), \Xmc)$.  Hence, we have that $\Zmc \subseteq \Xmc$. Since every subset of an
  admissible set is also admissible, \Zmc is also admissible.

  For the if-direction we assume that $\Hmc \models \Bmfb$ and that \Zmc is admissible.
  If $\Hmc \models \Bmfb$, then \Bmfb is outer consistent w.r.t~\Zmc. Since \Zmc is admissible, we
  know, due to Lemma~\ref{lem:admissible-and-outerConsistent}, that \Bmf is consistent.
\end{proof}



Due to Lemma \ref{lem:consistant-and-admissible-types}, we do not need to construct the set \Xmc
first. We can also enumerate all models \Hmc of \Bmfb, and check for each \Hmc if the occurring
types are admissible. Of course, if there exist one model of \Bmfb, then there exists infinitely
many. But we only need to check those that are \emph{essentially different}, i.e.\ the set of
occurring restricted \todo{define ``restricted types in chapter 3''} types differs.

\begin{definition}[Essentially equal interpretations]
  The two \Msig-interpretations $\Hmc_{1}$ and $\Hmc_{2}$ are \emph{essential equal} if $\Zmc_{\Hmc_{1}} =
  \Zmc_{\Hmc_{2}}$ where $\Zmc_{\Hmc_{1}}$ and $\Zmc_{\Hmc_{2}}$ are defined as
  \begin{align*}
    \Zmc_{\Hmc_{1}} & \coloneqq \{\mathsf{type}_{\ran(b)}^{\Hmc_{1}}(d) \mid d \in \Delta^{\Hmc_{1}}\}
               \text{, and} \\
    \Zmc_{\Hmc_{2}} & \coloneqq \{\mathsf{type}_{\ran(b)}^{\Hmc_{2}}(d) \mid d \in \Delta^{\Hmc_{2}}\}.\qedhere
  \end{align*}

\end{definition}

Using the results of Lemma \ref{lem:admissibility-without-rigid},
\ref{lem:admissibiliy-with-rigid} and \ref{lem:consistant-and-admissible-types}, we can construct a simple algorithm, as depicted in
Algorithm~\ref{alg:1}. Note that on the object level only classical consistency checks are used. On
meta level, the bare information about consistency is not sufficient, since we also need the
knowledge about the restricted types occurring in the model. Hence, a DL reasoner that constructs
a model is necessary for the meta level.


\IncMargin{1em}
\RestyleAlgo{ruled}
\begin{algorithm}[t]
  \SetAlgoVlined
  \setstretch{1.1}
  \DontPrintSemicolon
  \SetKwData{true}{true}
  \SetKwData{false}{false}
  \SetKwInOut{Input}{Input}
  \SetKwInOut{Output}{Output}
  %
  \Input{\LMLO-BKB \Bmf}
  \Output{\true if \Bmf is consistent, \false otherwise}
  \BlankLine
  $\Hmf \coloneqq \{\Hmc \mid \Hmc\models\Bmfb \text{, up to essential equality}\}$\;
  \For{$\Hmc \in \Hmf$}{
    $\Zmc_{\Hmc} \coloneqq \{\mathsf{type}_{\ran(b)}^{\Hmc}(d) \mid d \in \Delta^{\Hmc}\}$\;
    \eIf{\Bmf contains rigid names}{
      \If{($\Omc_{\Zmc_{\Hmc}}, \RO')$ is consistent}{
        \vspace{0.5ex}\Return{\true}
      }
    }{
      $\Zmc_{\Hmc} = \{Z_{1}, \dots, Z_{k}\}$\;
      \If{$(\Omc_{Z_{i}}, \RO)$ is consistent for all $1 \leq i \leq k$}{
        \vspace{0.5ex}\Return{\true}
      }
    }
  }
  \Return{false}
  \caption{Algorithm for checking consistency of \LMLO-BKB \Bmf}\label{alg:1}
\end{algorithm}

\begin{lemma}\label{lem:alg1-sound-complete-terminating}
  Algorithm~\ref{alg:1} is sound, complete, and terminating.
\end{lemma}
\missingproof





\section{Contextual Hypertableau}
\label{sec:using-hypertableau}



As mentioned earlier ...

\todo[inline]{requirements}

\todo[inline]{By means of maintenance , use the same reasoner for meta and object level.}

\todo[inline]{expressivity OWL 2 DL profile}

\todo[inline]{OWL API implemented in Java -> JConHT also in Java -> }

\todo[inline]{survey paper manchester + ORE reports}

\todo[inline]{Main reasoning task: consistency}

\todo[inline]{hermit, konclude (C++), fact++ (C++), JFact, pellet, chainsaw (internally uses another reasoner )}

\todo[inline]{C++ more performant, but Java ???. Hermit is a very good trade-off. implemented in Java, but still
very performant based on underlying algorithm and due to advanced blocking strategies.}

\todo[inline]{-> Conclusion: We use HermiT.}

\todo[inline]{Hermit uses Hypertableau}

\todo[inline]{hermit}

\todo[inline]{hypertableau avoid unnecessary nondeterminism (or-branching)}

\todo[inline]{Hermit computes premodels which can be extended to model of ontology. blocked individuals, same
concept labels -> premodel has the same restricted type}

\todo[inline]{different blocking strategies dependant on used dl. anywhere blocking, ancestor blocking, atomic
single blocking, full single blocking, }

\todo[inline]{full subset blocking could be problematic, but is not used in HermiT.}


For brevity, we will present here only a few relevant parts of the Hypertableau Algorithm and refer
the interested reader to \todo{citation, journal paper, cade paper}. Like other tableau-based
methods the hypertableau calculus tries to construct an abstraction of a model for a given ontology
to check whether that ontology is consistent. But in contrast to the tableau calculi it operates
on a set of \emph{DL-clauses} and an ABox, instead of a TBox and an ABox.

\begin{definition}[DL-Clause]
  \mbox{ }

  \todo[inline, color=blue!40]{what is a dl clause}
  \todo[inline, color=blue!40]{satisfiability of a dl clause}
\end{definition}


\todo[inline, caption={paragraph about preprocessing}]{paragraph about preprocessing

  \begin{itemize}
  \item elimination of transitivity axioms
  \item normalization
  \item clausification
  \end{itemize}
}
\begin{definition}[Clausification]
  The \emph{clausification} of a \LM ontology $\Omc = (\T, \A)$ is the pair \CA \dots
\end{definition}


\begin{lemma}
  A \SHOIQ ontology \Omc is consistent if and only if $\Xi(\Delta(\Omega(\Omc)))$ is consistent and
  \todo[inline, color=blue!40]{set of restricted types are equal.\vspace{1cm}}
\end{lemma}

\todo[inline]{short introduction to hypertableau}

\begin{definition}[Hypertableau Algorithm]
  \mbox{ }

  \todo[inline,color=blue!40]{ABoxes}
  \todo[inline,color=blue!40]{Pairwise Anyway Blocking}
  \todo[inline,color=blue!40]{Derivation Rules}
  \todo[inline,color=blue!40]{Clash}
  \todo[inline,color=blue!40]{Derivation, leaf node}
  \todo[inline,color=blue!40]{complete ABox}
\end{definition}

In [BSH09] \todo{citation} it is shown that the hypertableau algorithm is sound, complete and
terminating. 

\todo[inline]{some paragraph explaining the next steps in our calculus}

\begin{lemma}\label{lem:model-has-abox}
  In any derivation for \CA, for each model \Hmc of \CA there exists some leaf node labeled with a
  clash-free ABox $\A'$ such that $\Hmc\models\A'$.
\end{lemma}

\missingproof

\todo[inline]{explaining next definition, reference to Def 3.10}

\begin{definition}[Admissibility of an ABox]
  Let \A be a meta ABox and let \RO be an object RBox. W.l.o.g.\ we assume that the meta individuals
  occurring in \A are $c_{1}$, \dots, $c_{k}$. We call \A \emph{admissible} if there exist
  \Osig-interpretations $\I_{1} = (\Delta, \cdot^{\I_{1}})$, \dots,
  $\I_{k} = (\Delta, \cdot^{\I_{k}})$ such that
  \begin{itemize}
  \item $x^{\I_{i}} = x^{\I_{j}}$ for all $x \in \OCR \cup \ORR \cup \OI$ and all
    $i,j\in\{1,\dots,k\}$, and
  \item every $\I_{i}$, $1 \leq i \leq k$, is a model of the \LO-BKB $\Bmf_{c_{i}} = (\Bmc_{c_{i}},
    \RO)$ over \Osig where
    \begin{align*}
      \Bmc_{c_{i}} & \coloneqq \bigwedge_{b(\oalpha)\in\Zpos{c}} \alpha \land
                     \bigwedge_{b(\oalpha)\in\Zneg{c}} \lnot \alpha \\
      \intertext{with}
      \Zpos{c} & \coloneqq \{A_{\oalpha} \mid A_{\oalpha}(c) \in \A \text{ and } A_{\oalpha} \in
                    \ran(\bsf)\} \text{ and} \\
    \Zneg{c} & \coloneqq \{A_{\oalpha} \mid \lnot A_{\oalpha}(c) \in \A \text{ and } A_{\oalpha} \in
                    \ran(\bsf)\}.
    \end{align*}

  \end{itemize}

\end{definition}

\todo[inline]{explanation for next lemma}

\begin{lemma}\label{lem:A-admissible-iff-ZH-admissible}
  Let \Ap be a \LM-ABox over \Msig such that \Ap labels a leaf node of a derivation for \CA. Then,
  \Ap is admissible if and only if there exists a model \Hmc of \Ap such that $\Zmc_{\Hmc}$ is
  admissible.
\end{lemma}

\begin{proof}
  Let \Ap be admissible and $c_{1}$, \dots, $c_{k}$ the meta individuals occurring in \A. We define
  $\HH$ such that
  \begin{align*}
    \Delta^{\Hmc} & = \{c_{1}, \dots, c_{k}\}, \\
    c_{i}^{\Hmc} & = c_{i} \text{ for each individual $c_{i}$ that occurs in an assertion in \Ap}, \\
    A^{\Hmc} & = \{c_{i} \in \Delta^{\Hmc} \mid A(c_{i}) \in \Ap\} \text{ for all $A\in\MC$, and} \\
    r^{\Hmc} & = \{(c_{i}, c_{j}) \in \Delta^{\Hmc} \times \Delta^{\Hmc} \mid r(c_{i}, c_{j}) \in
               \Ap\} \text{ for all $r \in \MR$}.
 \end{align*}
 Clearly, \Hmc models all role assertions and all concept assertions of the form $A(c)$ with
 $A\in\MC$ that occur in \Ap. For concept assertions of the form $\lnot A(c)$, we know that
 $A(c)\notin\Ap$, since \Ap is clash-free and thus the $\bot$-rule was never applied. Therefore, we
 have that $\Hmc\models\lnot A(c)$. Analogously, for any assertion of the form $(\atleast{n}{r}{B})(c)$

  \begin{itemize}
  \item Since \A clash-free, there exists model \Hmc
  \item \A admissible -> interpretations $\I_{1}$, \dots, $\I_{k}$ 
  \item in \A are only literal assertions, equality ($s\approx t$) or at-least assertions
  \item since \A is complete, for at-least assertions there exists necessary successors (with
    respective types)
  \item in admissibility for \ZH we have to look at all $A_{\oalpha}$
  \end{itemize}
 
  \todo[inline]{ausformulierung und andere richtung fehlt noch}
\end{proof}


Note that this lemma yields that for an inadmissible ABox \Ap there exists no model of \CA and \Ap
with admissible types. Thus, due to Lemma~\ref{lem:model-has-abox} we know that if all ABoxes which
label leaf nodes in a derivation are inadmissible, then \CA is inconsistent.
%
However, the converse does not hold. If \Ap is admissible and clash-free, it is still possible that
there exists no model \Hmc of \CA and \Ap such that \ZH is admissible as the following example
shows.

\begin{example}
  Let $\Bmfex = (\Bmcex,\emptyset,\emptyset)$ with $\Bmcex = \lnot C(s) \land \oax{\lnot A(a)} \sqsubseteq
  C \land \lnot C \sqsubseteq \oax{A\sqsubseteq\bot}$ be an \ALCALC ontology. Then,
  \begin{align*}
    \Bmfbex & = \big(\lnot C(s) \quad\land\quad 
              A_{\oax{\lnot A(a)}} \sqsubseteq C \quad\land\quad
              \lnot C \sqsubseteq A_{\oax{A\sqsubseteq\bot}} ,\quad \emptyset\big)\\
    \intertext{is the outer abstraction of \Bmfex. The normalization and clausification of \Bmfbex yields \CAex with}
    \Cex & = \{A_{\oax{\lnot A(a)}}(x) \to C(x), \quad \to C(x) \lor
           A_{\oax{A\sqsubseteq\bot}}(x)\},\\
    \Aex & = \{\lnot C(s)\}.\\
    \intertext{Any derivation of \CAex produces a leaf node labeled with}
    \Ap & = \{\lnot C(s),\ A_{\oax{A\sqsubseteq\bot}}(s)\}.
  \end{align*}
  Clearly, \Ap is admissible and in any model \HH of \Ap such that \ZH is admissible there exists
  $d\in\Delta^{\Hmc}$ with $s^{\Hmc} = d$ and $d \in {A_{\oax{A\sqsubseteq\bot}}}^{\Hmc}$. For \ZH
  to be admissible, we know that $X = \{A_{\oax{A\sqsubseteq\bot}}\} \notin \ZH$ since
  $\Bmc_{X} = A \sqsubseteq \bot \ \land\ \lnot(\lnot A(a))$ is not consistent . Thus, we also have
  $d \in {A_{\oax{\lnot A(a)}}}^{\Hmc}$. Because of $A_{\oax{\lnot A(a)}}(x) \to C(x)$ and
  $\lnot C(s)$, we know that \Hmc cannot be model of \CAex. In fact, there
  exists no model $\Hmc'$ of \CAex such that $\Zmc_{\Hmc'}$ is admissible
  since \Bmfex is inconsistent.
\end{example}

The above example illustrates that there can exist implicitly negated concept assertions in a
complete, clash-free meta ABox \Ap, i.e.\ concept assertions that would cause a clash if added to
the ABox. In the proof of Lemma~\ref{lem:A-admissible-iff-ZH-admissible}, we may need to add certain
concept assertions in order to assure the admissibility.
\todo[inline]{further explanation}

\begin{definition}[Repletion of DL-clauses]
  Let \Cmc be a set of \LM-clauses over \Msig and \A an \LM-ABox over \Msig. The \emph{repletion of
    \Cmc} is obtained from \Cmc by adding the \LM-clause
  \begin{align*}
    \to\ A_{\oalpha}(x)\ \lor\ A_{\oax{\alpha^{*}}}(x)
  \end{align*}
 to \Cmc for each
  $A_{\oalpha} \in \ran(\bsf)$ that occurs in \Cmc or \A, where
  $A_{\oax{\alpha^{*}}} = b(\alpha^{*})$ and $\alpha^{*}$ is the weakly negation of $\alpha$.

  For an \LM-ontology \Omcb, the \emph{repleted clausification} is obtained from the clausification \CA
  of \Omcb where \Cmc is replaced with its repletion.
\end{definition}

\todo[inline]{further explanation}

\begin{lemma}[Completeness]
  Let \Omc be an \LMLO-ontology, \Omcb its outer abstraction and \CA the repleted clausification of
  \Omcb. 
  %
  Then, if a derivation exists such that a leaf node is labeled with a clash-free and admissible
  ABox \Ap, then \Omc is satisfiable.
\end{lemma}

\missingproof


In the completeness proof for the hypertableau algorithm in
\textbf{[MSH09]} \todo{citation} ...based on paths, if A(s) is not in \A, then 
auffüllen
repletion

But in Lemma above, we may need to add certain concept assertions in order to grant the
admissibility. 

either additionally add relevant assertions or assure that they are not needed for admissibility.

For each



\IncMargin{1em}
\RestyleAlgo{ruled}
\begin{algorithm}[t]
  \SetAlgoVlined
  \setstretch{1.1}
  \DontPrintSemicolon
  \SetKwData{true}{true}
  \SetKwData{false}{false}
  \SetKwInOut{Input}{Input}
  \SetKwInOut{Output}{Output}
  %
  \Input{\LMLO-BKB \Bmf}
  \Output{\true if \Bmf is consistent, \false otherwise}
  \BlankLine
  %
  preprocessing:\;
  elimination of transitivity axioms, normalization, clausification\;
  add $\to A_{\oalpha}(x) \lor A_{}$ to \Cmc\;
  %
  \BlankLine
  let $(T,\lambda)$ be any derivation for \CA\;
  $\Amf \coloneqq \{ \Ap \mid \text{there exists a leaf node in $(T,\lambda)$ that is labeled with \Ap}\}$\;
  \For{$\Ap \in \Amf$}{
    \If{\Ap is clash-free}{}
%
%
%
    $\Zmc_{\Hmc} \coloneqq \{\mathsf{type}_{\ran(b)}^{\Hmc}(d) \mid d \in \Delta^{\Hmc}\}$\;
    \eIf{\Bmf contains rigid names}{
      \If{($\Omc_{\Zmc_{\Hmc}}, \RO')$ is consistent}{
        \vspace{0.5ex}\Return{\true}
      }
    }{
      $\Zmc_{\Hmc} = \{Z_{1}, \dots, Z_{k}\}$\;
      \If{$(\Omc_{Z_{i}}, \RO)$ is consistent for all $1 \leq i \leq k$}{
        \vspace{0.5ex}\Return{\true}
      }
    }
  }
  \Return{false}
  \caption{Algorithm for checking consistency of \LMLO-BKB \Bmf with Hypertableau}\label{alg:2}
\end{algorithm}

%  When constructing a model for \CA out of \Ap ... 

% Another preprocessing step for the DL clauses can eliminate these implicit negated concept
% assertions. Question whether $\Ap \cup \{A_{\oalpha}(s)\}$ causes a clash. Either

% \begin{definition}[Elimination of implicit negative concept assertions]
%   Let \Cmc be a set of DL clauses.
% \end{definition}

% \begin{lemma}
%   A set \Cmc of DL clauses is satisfiable if and only if $\Omega(\Cmc)$ is satisfiable.
% \end{lemma}


% \vspace{3cm}

% \noindent\rule{\textwidth}{5pt}


% For our calculus another property is important. If $(\Cmc, \A)$ is satisfiable, then
% for every model~\Hmc of $(\Cmc, \A)$ and for every derivation of $(\Cmc, \A)$ there is a leaf node
% labeled with a clash-free ABox~$\A'$ such that the assertions in~$\A'$ induce the types
% occurring in~\Hmc.

% First, we introduce some notions.\todo{rephrase}

% \begin{definition}[Induced types]
%   Let \A be a meta ABox and $c$ be a meta individual occurring in \A. Then the sets of \emph{positive} and \emph{negative asserted referring concepts
%   \Zpos{c}} and \emph{\Zneg{c} for $c$} are defined as
%   \begin{align*}
%     \Zpos{c} & \coloneqq \{A_{\oalpha} \mid A_{\oalpha}(c) \in \A \text{ and } A_{\oalpha} \in
%                     \ran(\bsf)\} \text{ and} \\
%     \Zneg{c} & \coloneqq \{A_{\oalpha} \mid \lnot A_{\oalpha}(c) \in \A \text{ and } A_{\oalpha} \in
%                     \ran(\bsf)\}.
%   \end{align*}
%   The \emph{by $c$ induced restricted types \types{c}} are defined as follows:
%   \begin{align*}
%     Y \in \types{c} \textIff Y \subseteq \ran(\bsf)\text{, }\Zpos{c} \subseteq Y \text{ and } \Zneg{c}
%     \subseteq ran(\bsf) \setminus Y.
%   \end{align*}
%   The \emph{set of induced restricted types \typesA} is defined as $\typesA \coloneqq
%   \bigcup_{c\in\MI(\A)} \types{c}$.
% \end{definition}

% \begin{lemma}\label{lem:ABox-induces-types-in-model}
%   For each model \HH of $(\Cmc, \A)$ with $\Zmc_{\Hmc} \coloneqq \{\mathsf{type}_{\ran(b)}^{\Hmc}(d)
%   \mid d \in \Delta^{\Hmc}\}$ in any derivation of $(\Cmc, \A)$ there exists a leaf node labeled
%   with a clash-free ABox $\A'$ such that for each restricted type $Z\in\Zmc_{\Hmc}$ there exists
%   $c\in\MI$ with $\Zpos[\A']{c} \subseteq Z$ and $\Zneg[\A']{c} \subseteq \ran(\bsf) \setminus Z$ where
%   \begin{align*}
%     \Zpos[\A']{c} & \coloneqq \{A_{\oalpha} \mid A_{\oalpha}(c) \in \A' \text{ and } A_{\oalpha} \in
%                     \ran(\bsf)\}, \\
%     \Zneg[\A']{c} & \coloneqq \{A_{\oalpha} \mid \lnot A_{\oalpha}(c) \in \A' \text{ and } A_{\oalpha} \in
%                     \ran(\bsf)\}.
%   \end{align*}
  
% \end{lemma}


% \missingproof

%  If there exists a
% derivation for $(\Cmc, \Amc)$ with a leaf node labeled with a clash-free ABox $\A'$, then not only a
% model \I of $(\Cmc,\A)$ can be constructed from $\A'$, but the types occurring in \I also occur in
% $\A'$.

% \begin{lemma}
%   If a derivation for $(\Cmc, \A)$ exists in which some leaf node is labeled with a clash-free ABox
%   $\A'$, then for each $Z \in \Zmc_{\I}$
% \end{lemma}

% In Algorithm~\ref{alg:1} we need to enumerate over all essentially different models. By
% Lemma~\ref{lem:ABox-induces-types-in-model} we know that it is sufficient to enumerate

% \todo[inline,color=yellow]{}

% ... as the following example shows. \Zmf \Amf

% \Amf \Bmf \Cmf \Dmf \Emf \Fmf \Gmf \Hmf \Imf \Jmf \Kmf \Lmf \Mmf \Nmf \Omf \Pmf \Qmf \Rmf \Smf \Tmf
% \Umf \Vmf \Wmf \Xmf \Ymf \Zmf

% \Amc \Bmc \Cmc \Dmc \Emc \Cmc \Gmc \Hmc \Imc \Jmc \Kmc \Lmc \Mmc \Nmc \Omc \Pmc \Qmc \Rmc \Smc \Tmc
% \Umc \Vmc \Wmc \Xmc \Ymc \Zmc

% \begin{example}
  
% \end{example}


% \noindent\rule{\textwidth}{5pt}

% Therefore (Due to Lemma ??) when enumerating all essentially equal models, it is enough to check all
% clash-free leafs of a derivation.


% If a leaf in a derivation is labelled with a clash-free ABox \A, it represents premodel. With
% well-known technique of unraveling \todo{citation} a model of $(\Cmc, \A)$ can be
% constructed. 
% \todo[inline]{one premodel can represent more than one essential different model of $(\Cmc, \A)$.}

 



\vspace{3cm}




In the hypertableau algorithm, other blocking strategies besides \textsf{Anywhere Blocking} can also
be applied dependant on the expressivity of the description logic, namely \textsf{Atomic Single
  Blocking} and \textsf{Full Single Blocking.}

\vspace{1cm}

So with a preprocessing step, we assure that if a node $n$ is not labelled with $\lnot
A_{\oax{\alpha}}$, then either labelling it with $A_{\oax{\alpha}}$ does not harm or adding
$A_{\oax{\alpha}}$ would make the object ontology inconsistent.

\section{Implementing JConHT}
\label{sec:implementing-jconht}

The reasoner is called \emph{JConHT} which stands for \emph{J}ava-implemented \emph{Con}text
description logic reasoner based on \emph{H}ermi\emph{T}.

JConHT is an OWL compliant reasoner for contextualized description logics that is written in Java
and uses HermiT as internal reasoner.

Similar to

% to avoid tikz - verbatim error
\clearpage

\subsection{Syntax}
\label{sec:syntax}

\todo[inline]{http://disi.unitn.it/~bouquet/papers/ISWC2003-COWL.pdf}

as widely used for DL reasoner we also use the web ontology language (OWL) for our reasoner. 

use special OWL annotations.

Use outer abstraction and separately define what abstracted meta concepts mean.


We decided to use \verb+rdfs:isDefinedBy+

Let us, once again, consider example~\ref{ex:outer-abstraction}:
\begin{example}\label{ex:outer-abstraction-as-OWL}
  Let
  $\Omc \coloneqq (C\sqsubseteq(\oax{A\sqsubseteq\bot}) \land (C\sqcap\oax{A(a)})(c), \emptyset,
  \emptyset)$ be an \ALCALC ontology. Then \Omc looks in OWL syntax as follows:

\begin{verbatim}
SubclassOf(cls:C cls:A_ASubBot)
ClassAssertion(ObjectIntersectionOf(cls:C cls:A_Aa) ind:c)
SubclassOf(Annotation(rdfs:isDefinedBy cls:A_ASubBot) cls:A owl:Bottom)
ClassAssertion(Annotation(rdfs:isDefinedBy cls:A_Aa) cls:A ind:a)
\end{verbatim}

\vspace{-2.0\baselineskip}  
\end{example}

Furthermore, in practical applications we often encounter object axioms that must hold independently
of any context. These so-called \emph{global object axioms} are of the form
$\top \sqsubseteq \oalpha$. Using the above approach would introduce a new abstracted \todo{is that
  defined somewhere?} meta concept for each such axiom and, thus, unnecessarily bloat the OWL
ontology. Instead we decided to handle another OWL annotation with a special meaning:
\verb+rdfs:label "global"+. Consider a light variation of example~\ref{ex:outer-abstraction-as-OWL}:

\begin{example}\label{ex:outer-abstraction-as-OWL-w-global}
  Let $\Omc \coloneqq (\top\sqsubseteq(\oax{A\sqsubseteq\bot}) \land \oax{A(a)}(c), \emptyset, \emptyset)$ be
  an \ALCALC ontology. Then \Omc looks in OWL syntax as follows:

\begin{verbatim}
ClassAssertion(cls:A_Aa ind:c)
ClassAssertion(Annotation(rdfs:isDefinedBy cls:A_Aa) cls:A ind:a)
SubclassOf(Annotation(rdfs:label "global") cls:A owl:Bottom)
\end{verbatim}

\vspace{-2.0\baselineskip}  
\end{example}

\clearpage

\section{Section 5.2}
\label{sec:section-5.2}






From Lemma \ref{lem:admissible-and-outerConsistent} we know that it is necessary that \Ob is
consistent. Assuming \Ob is consistent, we still have to find a set of types
$\Xmc\subseteq\powerset{\ran(\bsf)}$ such that \Xmc is admissible and \Ob is outer consistent
w.r.t.~\Xmc.

\noindent
\begin{tikzpicture}
  %\grid{(-7,0)}{(7,4)}
  \node[draw] (a) at (0,4) {\Bb consistent?};
  \node[draw,below left = -8mm and -30mm of a] (b) at (-5,2) {construct \Xmc \ldots set of types};
  \draw[->] (a) to[swap] node[inner sep=0]{yes, with $\I\models\Bb$} (b);
  \node[draw,below right = of a] (c) {\textbf{FALSE}};
  \draw[->] (a) to node[inner sep=0]{no} (c);
  \node[below of = b] (d) {Is \Xmc admissible?};
  \draw[->] (b) to (d);
  \node[below left = of d] (e){\textbf{TRUE}};
  \draw[->] (d) to[swap] node[inner sep=0]{yes} (e);
  \node[below right = of d] (f) {backtracking};
  \draw[->] (d) to node[inner sep=0]{no} (f);
  \node[below of = f] (g) {find any admissible \Xmc?};
  \draw[->] (f) to (g);
  \node[below left = of g] (h){\textbf{TRUE}};
  \draw[->] (g) to[swap] node[inner sep=0]{yes} (h);
  \node[below right = of g] (i){\textbf{FALSE}};
  \draw[->] (g) to node[inner sep=0]{no} (i);
\end{tikzpicture}


No rigid names, so we can look into each world separately.





\todo[inline]{quite a bit missing here.}

\begin{lemma}
  Let \Bmf be a consistent BKB over \Nsig, let \I be a model of \Bmf, and let $\alpha$ be an axiom
  over \Nsig. 
\end{lemma}

\todo[inline]{the next paragraph comes after a general introduction about the block box approach.}







% As every relevant description logic reasoner uses the Web Ontology Language (OWL), we have to adapt
% our general setting in order to stay compliant with the usual assumptions. Most importantly OWL does
% not make the unique name assumption. In contrast to the arguments given in section
% \ref{sec:description-logics} in favour of the UNA, individual names are rather seen as an label for
% an object in OWL. Especially if one wants to merge two different ontologies talking about the same
% topic, it seems quite natural to be able to state that two individual names actually represent the
% same object. Furthermore, OWL2 allows for a so-called \emph{Individual Inequality Axiom} which can be
% used to axiomatize the unique name assumption if needed.

% As a design decision we chose to also neglect the UNA in our case. Consequently, we then also drop
% the rigid individual assumption we made in chapter \ref{cha:context-dls}. When individual names are
% seen as labels, of course, these could change from context to context. To be also able to express
% rigid individuals we analogously introduce the set of \emph{rigid individual names }$\OIR \subseteq
% \OI$. Straightforward we adapt the notions of a nested interpretation and of admissibility.

% \begin{definition}[Nested interpretation (without RIA)]\label{def:nested-interpretation-without-ria}
% A \emph{nested interpretation} is a tuple \JJ, where \Cbb is a non-empty set (called
%   \emph{contexts}) and $(\Cbb,\cdot^\J)$ is an \Msig-interpretation.
%   %
%   Moreover, for every $c\in\Cbb$, $\I_c\coloneqq(\Delta^{\J},\cdot^{\I_c})$ is an \Osig-interpretation
%   such that we have for all $c,c'\in\Cbb$ that $x^{\I_{c}}=x^{\I_{c'}}$ for every
%   $x\in\OIR\cup\OCR\cup\ORR$.
% \end{definition}

% \begin{definition}[Admissibility (without RIA)]\label{def:admissibility-without-ria}
%   Let $\Xmc=\{X_1,~\dots,\ X_k\}\subseteq\powerset{\ran(\bsf)}$.  We call \Xmc \emph{admissible} if
%   there exist \Osig-interpretations $\I_1=(\Delta,\cdot^{\I_1})$,~\dots,
%   $\I_k=(\Delta,\cdot^{\I_k})$ such that
%   \begin{enumerate}
%   \item $x^{\I_i}=x^{\I_j}$ for all $x\in\OIR\cup\OCR\cup\ORR$ and all $i,j\in\{1,\dots,k\}$, and
%   \item every $\I_i$, $1\le i\le k$, is a model of the \LO-BKB $\Bmf_{X_{i}}= (\B_{X_i},\RO)$
%     over~\Osig where
%     \begin{align*}
%       \B_{X_i}:=\bigwedge_{\bsf(\oalpha)\in X_i}\alpha\ \land
%       \bigwedge_{\bsf(\oalpha)\in\ran(\bsf)\setminus X_i}\lnot\alpha.
%     \end{align*}
%   \end{enumerate}
%   \vspace{-1.7\baselineskip}
% \end{definition}




% \todo[inline]{What happens with complexity results?}




%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../thesis"
%%% reftex-default-bibliography: ("../references.bib")
%%% End:

%  LocalWords:  performant axiomatize iff logics clausification inline ABox
